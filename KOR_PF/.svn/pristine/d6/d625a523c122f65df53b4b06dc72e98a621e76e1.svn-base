<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.pf.exp.service.impl.pfExportMapper">

	<!-- Invoice 등록 조회 -->
	<select id="selectExportInList" parameterType="searchVO" resultType="egovMap">
		SELECT 
		    COUNT(*) OVER() AS cnt,
		    invoice_no, 
		    rece, 
		    CASE WHEN rpt_no != '' THEN CONCAT_WS('-', SUBSTRING(rpt_no, 1, 5), SUBSTRING(rpt_no, 6, 2), SUBSTRING(rpt_no, 8)) ELSE '' END AS rpt_no, 
		    CASE WHEN Rpt_Day != '' THEN DATE_FORMAT(Rpt_Day, '%Y-%m-%d') ELSE '' END AS rpt_day, 
		    CASE WHEN exp_Lis_Day != '' THEN DATE_FORMAT(exp_Lis_Day, '%Y-%m-%d') ELSE '' END AS exp_Lis_Day, 
		    pdf, 
		    TYPE, 
		    request_yn
		FROM (
		    SELECT 
		        A.invoice_No, 
		        CASE WHEN B.rece != '' THEN B.rece ELSE '' END AS rece, 
		        CASE WHEN B.rpt_no != '' OR B.rpt_no IS NOT NULL THEN B.rpt_no ELSE '' END AS rpt_no, 
		        CASE WHEN B.rpt_day != '' THEN B.rpt_day ELSE '' END AS rpt_day, 
		        CASE WHEN B.exp_Lis_Day != '' THEN B.exp_Lis_Day ELSE '' END AS exp_Lis_Day, 
		        A.docu_org_file AS pdf, 
		        CASE WHEN B.type = '' OR B.type IS NULL THEN A.CMPNY_CD ELSE B.type END AS TYPE, 
		        CASE WHEN B.rpt_no != '' OR B.rpt_no != NULL THEN 'Y' ELSE A.request_yn END AS request_yn
		    FROM file_info A
		    LEFT JOIN (
		        SELECT 
		            b.mg_code AS invoice_no, 
		            a.rece, 
		            a.rpt_no, 
		            a.Rpt_Day, 
		            a.exp_Lis_Day, 
		            '' AS pdf, 
		            exp_firm AS TYPE
		        FROM cusdec830a1 A
		        INNER JOIN (
		            SELECT sna1, rpt_no, mg_code
		            FROM cusdec830b1
		            GROUP BY sna1, rpt_no
		        ) B ON A.sn = B.sna1 AND A.rpt_no = B.rpt_no
		        WHERE 1=1 AND A.rpt_seq = '00'
		    ) B ON A.INVOICE_NO = B.INVOICE_NO
		    WHERE A.file_type = 'exp' AND A.docu_type = 'CI' 
		    <!-- <if test="cmpnyCd != null and cmpnyCd != ''">
				AND A.cmpny_cd = #{cmpnyCd}
		    </if> -->
		    <if test="list != null and list.size() > 0">
	            AND A.cmpny_cd IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
		    UNION 
		
		    SELECT 
		        B.invoice_No, 
		        B.rece, 
		        B.rpt_no, 
		        B.rpt_day, 
		        B.exp_Lis_Day, 
		        IFNULL(A.docu_org_file,'') AS pdf, 
		        B.type, 
		        A.request_yn
		    FROM file_info A
		    RIGHT JOIN (
		        SELECT 
		            b.mg_code AS invoice_no, 
		            a.rece, 
		            a.rpt_no, 
		            a.Rpt_Day, 
		            a.exp_Lis_Day, 
		            '' AS pdf, 
		            exp_firm AS TYPE
		        FROM cusdec830a1 A
		        INNER JOIN (
		            SELECT sna1, rpt_no, mg_code
		            FROM cusdec830b1
		            GROUP BY sna1, rpt_no
		        ) B ON A.sn = B.sna1 AND A.rpt_no = B.rpt_no
		        WHERE 1=1 AND A.rpt_seq = '00'
		        <!-- <if test="cmpnyCd != null and cmpnyCd != ''">
				    AND A.exp_firm = #{cmpnyCd}
				</if> -->
				<if test="list != null and list.size() > 0">
		            AND A.exp_firm IN 
		            <foreach item="id" collection="list" open="(" separator="," close=")">
		                #{id}
		            </foreach>
	        	</if>
				<choose>
				    <when test="srch6 == '01'">
				        AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
				    </when>
				    <otherwise>
				        AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
				    </otherwise>
				</choose>
		    ) B ON A.INVOICE_NO = B.INVOICE_NO 
		    AND A.DOCU_TYPE = 'CI'
		    AND A.FILE_TYPE = 'exp'
		    
		    UNION ALL 
		
			SELECT 
			    ci_no, 
			    '임시저장' AS rece, 
			    '' AS rpt_no, 
			    '' AS rpt_day, 
			    '' AS exp_Lis_Day, 
			    '' AS pdf, 
			    CMPNY_CD AS TYPE, 
			    '' AS request_yn
			FROM invoice_info_temp
			WHERE 1=1
			<!-- <if test="cmpnyCd != null and cmpnyCd != ''">
				AND cmpny_cd = #{cmpnyCd}
			</if> -->
			
			<if test="list != null and list.size() > 0">
	            AND cmpny_cd IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
		) A
		WHERE 1=1 
		    <if test="srch4 != null and srch4 != ''">
				AND rpt_no LIKE CONCAT('%',UPPER(REPLACE(#{srch4},'-','')),'%')
			</if>
			<if test="srch5 != null and srch5 != ''">
				AND invoice_no LIKE CONCAT('%',UPPER(#{srch5}),'%')
			</if>
			<choose>
			<when test="srch6 == '01'">
				AND (rpt_day = '' OR rpt_day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','') )
			</when>
			<otherwise>
				AND (exp_Lis_Day = '' OR exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','') )
			</otherwise>
			</choose>
			<choose>
				<when test="srch1 == '02'">
				    AND rpt_no != ''
				</when>
				<when test="srch1 == '03'">
				    AND (rpt_no = '' AND rece = '')
				</when>
			</choose>  
		ORDER BY rpt_day desc, rpt_no desc
		LIMIT #{recordCountPerPage} OFFSET #{startPage};
	</select>
	
	<select id="selectTempInvoiceMainList" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM export_main_temp
		WHERE invoice_no = #{srch1};
	</select>
	
	<select id="selectTempInvoiceSubList" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM export_item_temp
		WHERE main_seq = 
		(SELECT main_seq FROM export_main_temp WHERE invoice_no = #{srch1});
	</select>
	
	<delete id="deleteTempExpMakeInList" parameterType="searchVO">
		DELETE FROM export_main_temp 
		WHERE main_seq = #{srch1};
	</delete>
	
	<delete id="deleteTempExpMakeInSubList" parameterType="searchVO">
		DELETE FROM export_item_temp 
		WHERE main_seq = #{srch1};
	</delete>
	
	<insert id="saveMakeInFile" parameterType="egovframework.pf.exp.service.SaveExpFileVO">
		INSERT INTO file_info
		(	FILE_TYPE
		  ,	RPT_NO
		  ,	BLNO
		  , INVOICE_NO
		  , UPLOAD_DT
		  , DOCU_TYPE
		  , DOCU_PATH
		  , DOCU_FILE
		  , DOCU_ORG_FILE
		  , DEL_YN
		  , REG_DT
		  , REG_ID
		  , CMPNY_CD
		  , REQUEST_YN
		) VALUES (
		  'exp'
		  ,	''
		  ,	''
		  , #{invoiceNo}
		  , #{uploadDt}
		  , 'CI'
		  , '/home/files'
		  , #{orgFileName}
		  , #{orgFileName}
		  , 'N'
		  , #{uploadDt}
		  , ''
		  , #{cmpnyCd}
		  , 'N'
		);
	</insert>

	<insert id="insertExportFilesInfo" parameterType="egovframework.pf.exp.service.SaveExpFileVO">
		INSERT INTO file_info
		(	FILE_TYPE
		  ,	RPT_NO
		  ,	BLNO
		  , INVOICE_NO
		  , UPLOAD_DT
		  , DOCU_TYPE
		  , DOCU_PATH
		  , DOCU_FILE
		  , DOCU_ORG_FILE
		  , DEL_YN
		  , REG_DT
		  , REG_ID
		  , CMPNY_CD
		  , REQUEST_YN
		) VALUES (
		  'exp'
		  ,	REPLACE(#{rptNo},'-','')
		  ,	''
		  , #{invoiceNo}
		  , #{uploadDt}
		  , #{name}
		  , '/home/files'
		  , #{fileName}
		  , #{orgFileName}
		  , 'N'
		  , #{regDt}
		  , #{regId}
		  , #{cmpnyCd}
		  <choose>
		  <when test="rptNo != '' and rptNo != null">
		  ,'Y'
		  </when>
		  <otherwise>
		  ,'N'
		  </otherwise>
		  </choose>
		);
	</insert>
	
	<!-- 같은 Invoice의 B/L, packing List 띄우는 팝업창  -->
	<select id="selectInFilesList" parameterType="searchVO" resultType="egovMap">
		SELECT
		   INVOICE_NO,
		   DOCU_TYPE,
		   DOCU_FILE,
		   DOCU_ORG_FILE,
		   DOCU_PATH,
		   CONCAT(SUBSTRING(UPLOAD_DT, 1, 4), '-', SUBSTRING(UPLOAD_DT, 5, 2), '-', SUBSTRING(UPLOAD_DT, 7, 2)) AS UPLOAD_DT
		FROM file_info
		WHERE invoice_No = #{srch1};
	</select>
	
	<select id="selectExpViewFilesList" parameterType="searchVO" resultType="egovMap">
		SELECT
		   RPT_NO,
		   DOCU_PATH,
		   DOCU_TYPE,
		   DOCU_FILE,
		   DOCU_ORG_FILE,
		   BLNO,
		   INVOICE_NO,
		   CONCAT(SUBSTRING(UPLOAD_DT, 1, 4), '-', SUBSTRING(UPLOAD_DT, 5, 2), '-', SUBSTRING(UPLOAD_DT, 7, 2)) AS UPLOAD_DT
		FROM file_info
		WHERE rpt_no = #{srch1};
	</select>
	
	<!-- 편집 버튼의 PDF 파일 저장 -->
	<update id="saveExportFileInfo" parameterType="egovframework.pf.exp.service.SaveExpFileVO">
		UPDATE file_info SET
		docu_type = #{name},
		docu_file = #{fileName},
		docu_org_file = #{orgFileName}
		WHERE invoice_NO = #{exportInNo}
	</update>
	
	<!-- Invoice 생성 페이지의 loading Port 드롭다운 데이터 가져오기 -->	
	<select id="selectExportMkInList" parameterType="searchVO" resultType="egovMap">
		SELECT cmmn_cd, cmmn_nm
		FROM cmmn_cd
		WHERE grp_cd = 'LOADPORT'
		<if test="srch1 != '' and srch1 != null">
		AND (cmmn_cd like CONCAT('%',UPPER(#{srch1}),'%') OR cmmn_nm like CONCAT('%',UPPER(#{srch1}),'%'))
		</if>
	</select>
	
	<select id="selectExportMkInIncotermsList" parameterType="searchVO" resultType="egovMap">
		SELECT cmmn_cd, cmmn_nm
		FROM cmmn_cd
		WHERE grp_cd = 'INCOTERMS'
		AND cmmn_cd IN ('EXW', 'FCA', 'CPT', 'CIP', 'DAP', 'DPU', 'DDP', 'FAS', 'FOB', 'CFR', 'CIF')
		<if test="srch1 != '' and srch1 != null">
		AND (cmmn_cd like CONCAT('%',UPPER(#{srch1}),'%') OR cmmn_nm like CONCAT('%',UPPER(#{srch1}),'%'))
		</if>
	</select>
	
	<!-- Invoice 생성 페이지의 final destination 드롭다운 데이터 가져오기 -->	
	<select id="selectExportMkInAprPortList" parameterType="searchVO" resultType="egovMap">
		SELECT cmmn_cd, cmmn_nm
		FROM cmmn_cd
		WHERE grp_cd = 'ARRPORT'
		<if test="srch1 != '' and srch1 != null">
		 AND cmmn_cd LIKE CONCAT('%',UPPER(#{srch1}),'%')
		</if>
		LIMIT #{recordCountPerPage} OFFSET #{startPage};
	</select>
	
	<select id="selectExportMkInNationList" parameterType="searchVO" resultType="egovMap">
		SELECT cmmn_cd, cmmn_nm
		FROM cmmn_cd
		WHERE grp_cd = 'NATION'
		<if test="srch1 != '' and srch1 != null">
		 AND cmmn_cd LIKE CONCAT('%',UPPER(#{srch1}),'%')
		</if>
		ORDER BY 
		    CASE cmmn_cd
		        WHEN 'US' THEN 1
		        WHEN 'CN' THEN 2
		        WHEN 'JP' THEN 3
		        WHEN 'EU' THEN 4
		        WHEN 'KR' THEN 5
		        WHEN 'TW' THEN 6
		        WHEN 'VN' THEN 7
		        WHEN 'IN' THEN 8
		        WHEN 'SG' THEN 9
		        WHEN 'KH' THEN 10
		        ELSE 11
		    END,
		    cmmn_cd;
	</select>
	
	<select id="selectExportMkInUOMList" parameterType="searchVO" resultType="egovMap">
		SELECT cmmn_cd, cmmn_nm
		FROM cmmn_cd
		WHERE grp_cd = 'QUANTITY2'
		<if test="srch1 != '' and srch1 != null">
		    AND cmmn_cd LIKE CONCAT('%', UPPER(#{srch1}), '%')
		</if>
		ORDER BY 
		    CASE cmmn_cd
		        WHEN 'KG' THEN 1
		        WHEN 'MGM' THEN 2
		        ELSE 3
		    END,
		    cmmn_cd;
	</select>
	
	<select id="selectExportMkInCurrencyList" parameterType="searchVO" resultType="egovMap">
		SELECT cmmn_cd, cmmn_nm
		FROM cmmn_cd
		WHERE grp_cd = 'EXCHANGERT'
		<if test="srch1 != '' and srch1 != null">
		    AND cmmn_cd LIKE CONCAT('%', UPPER(#{srch1}), '%')
		</if>
		ORDER BY 
		    CASE cmmn_cd
		        WHEN 'USD' THEN 1
		        WHEN 'CNY' THEN 2
		        WHEN 'JPY' THEN 3
		        WHEN 'EUR' THEN 4
		        WHEN 'KRW' THEN 5
		        WHEN 'TWD' THEN 6
		        WHEN 'VND' THEN 7
		        WHEN 'INR' THEN 8
		        WHEN 'SGD' THEN 9
		        WHEN 'HKD' THEN 10
		        ELSE 11
		    END,
		    cmmn_cd;
	</select>
	
	<select id="selectExportMkPLtotCntList" parameterType="searchVO" resultType="egovMap">
		SELECT cmmn_cd, cmmn_nm
		FROM cmmn_cd
		WHERE grp_cd= 'PACKUNT'
		<if test="srch1 != '' and srch1 != null">
		AND (cmmn_cd like CONCAT('%',UPPER(#{srch1}),'%') OR cmmn_nm like CONCAT('%',UPPER(#{srch1}),'%'))
		</if>
	</select>
	
	<insert id="insertInvoiceMainList" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO EXPORT_MAIN(
		 CORP_NO,
		 SHIPPER,
		 ADDRESS,
		 CONSIGNEE,
		 CONSIGNEE_ADDRESS,
		 INVOICE_NO,
		 INVOICE_DATE,
		 INVOICE_TO,
		 LOADPORT,
		 FLIGHT,
		 PAYMENT,
		 TRADE,
		 FREIGHT,
		 FREIGHT_CURRENCY,
		 INSURANCE,
		 INSURANCE_CURRENCY,
		 DEPDATE,
		 DESTINATION,
		 MANUFACT,
		 TOTAL,
		 TOTAL_PRICE,
		 TOTAL_AMOUNT,
		 COMMENTS,
		 DEL_YN,
		 REG_DT,
		 REG_ID
		)VALUES(
			#{corpNo},
			#{shipper},
			#{address},
			#{consignee},
			#{consigneeAddress},
			#{invoiceNo},
			#{invoiceDate},
			#{invoiceTo},
			#{loadPort},
			#{flight},
			#{payment},
			#{trade},
			#{freight},
			#{freightCurrency},
			#{insurance},
			#{insuranceCurrency},
			#{depDate},
			#{destination},
			'',
			#{total},
			#{totalPrice},
			#{totalAmount},
			#{comments},
			'N',
			DATE_FORMAT(NOW(), '%Y%m%d'),
	  		#{regId}
	  		) ON DUPLICATE KEY
			UPDATE EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d')
			 , EDT_ID = #{edtId}
			 , SHIPPER = #{shipper}
			 , ADDRESS = #{address}
			 , CONSIGNEE = #{consignee}
			 , CONSIGNEE_ADDRESS = #{consigneeAddress}
			 , INVOICE_NO = #{invoiceNo}
			 , INVOICE_DATE = #{invoiceDate}
			 , INVOICE_TO = #{invoiceTo}
			 , CONSIGNEE  = #{consigneeAddress}
			 , LOADPORT = #{loadPort}
			 , FLIGHT = #{flight}
			 , PAYMENT = #{payment}
			 , TRADE = #{trade}
			 , FREIGHT = #{freight}
			 , FREIGHT_CURRENCY = #{freightCurrency}
			 , INSURANCE = #{insurance}
			 , INSURANCE_CURRENCY = #{insuranceCurrency}
			 , DEPDATE = #{depDate}
			 , DESTINATION = #{destination}
			 , MANUFACT = ''
			 , TOTAL = #{total}
			 , TOTAL_PRICE = #{totalPrice}
			 , TOTAL_AMOUNT = #{totalAmount}
			 , COMMENTS = #{comments}
			 , DEL_YN = 'N'
	</insert>
	
	<select id="checkTempInvoiceNumber" parameterType="searchVO" resultType="String">
		SELECT MAIN_SEQ
		FROM EXPORT_MAIN_TEMP
		WHERE INVOICE_NO = #{srch10}
	</select>
	
	<insert id="saveTempExpMakeInList" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO EXPORT_MAIN_TEMP(
		 CMPNY_CD,
		 CORP_NO,
		 SHIPPER,
		 ADDRESS,
		 CONSIGNEE,
		 CONSIGNEE_ADDRESS,
		 INVOICE_NO,
		 INVOICE_DATE,
		 INVOICE_TO,
		 LOADPORT,
		 FLIGHT,
		 PAYMENT,
		 TRADE,
		 FREIGHT,
		 FREIGHT_CURRENCY,
		 INSURANCE,
		 INSURANCE_CURRENCY,
		 DEPDATE,
		 DESTINATION,
		 MANUFACT,
		 TOTAL,
		 TOTAL_PRICE,
		 TOTAL_AMOUNT,
		 COMMENTS,
		 DEL_YN,
		 REG_DT,
		 REG_ID
		)VALUES(
			#{cmpnyCd},
			#{corpNo},
			#{shipper},
			#{address},
			#{consignee},
			#{consigneeAddress},
			#{invoiceNo},
			#{invoiceDate},
			#{invoiceTo},
			#{loadPort},
			#{flight},
			#{payment},
			#{trade},
			#{freight},
			#{freightCurrency},
			#{insurance},
			#{insuranceCurrency},
			#{depDate},
			#{destination},
			'',
			#{total},
			#{totalPrice},
			#{totalAmount},
			#{comments},
			'N',
			DATE_FORMAT(NOW(), '%Y%m%d'),
	  		#{regId}
	  	) 
	</insert>
	
	<insert id="saveTempExpMakeInSubList" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO EXPORT_ITEM_TEMP(
		 MAIN_SEQ,
		 ITEM_CODE,
		 HS_CODE,
		 ITEM_NAME,
		 GOODS_DESCRIPTION,
		 NATION,
		 QUANTITY,
		 UOM,
		 UNIT_PRICE,
		 CURRENCY,
		 AMOUNT,
		 DEL_YN,
		 REG_DT,
		 REG_ID
		)VALUES(
			#{mainIndex},
			#{itemCode},
			#{hsCode},
			#{itemName},
			#{goodDes},
			#{nation},
			#{quantity},
			#{uom},
			#{unitPrice},
			#{currency},
			#{amount},
			'N',
			DATE_FORMAT(NOW(), '%Y%m%d'),
	  		#{regId}
	  	) 
	</insert>
	
	<select id="selectTempInvoiceMainIdex" parameterType="egovframework.pf.exp.service.SaveExpMainVO" resultType="String">
		SELECT MAIN_SEQ
		FROM EXPORT_MAIN_TEMP
		WHERE INVOICE_NO = #{invoiceNo}
	</select>
	
	<select id="selectInvoiceMainIdex" parameterType="egovframework.pf.exp.service.SaveExpMainVO" resultType="String">
		SELECT MAIN_SEQ
		FROM EXPORT_MAIN
		WHERE INVOICE_NO = #{invoiceNo}
	</select>
	
	<select id="checkInvoiceNumber" parameterType="searchVO" resultType="String">
		SELECT MAIN_SEQ 
		FROM EXPORT_MAIN
		WHERE INVOICE_NO = #{srch10}
	</select>
	
	<insert id="insertInvoiceSubList" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO EXPORT_ITEM(
		 MAIN_SEQ,
		 ITEM_CODE,
		 HS_CODE,
		 ITEM_NAME,
		 GOODS_DESCRIPTION,
		 NATION,
		 QUANTITY,
		 UOM,
		 UNIT_PRICE,
		 CURRENCY,
		 AMOUNT,
		 DEL_YN,
		 REG_DT,
		 REG_ID
		)VALUES(
			#{mainIndex},
			#{itemCode},
			#{hsCode},
			#{itemName},
			#{goodDes},
			#{nation},
			#{quantity},
			#{uom},
			#{unitPrice},
			#{currency},
			#{amount},
			'N',
			DATE_FORMAT(NOW(), '%Y%m%d'),
	  		#{regId}
	  		) ON DUPLICATE KEY
			UPDATE EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d')
			 , EDT_ID = #{edtId}
			 , ITEM_CODE = #{itemCode}
			 , HS_CODE = #{hsCode}
			 , ITEM_NAME = #{itemName}
			 , GOODS_DESCRIPTION = #{goodDes}
			 , NATION = #{nation}
			 , QUANTITY = #{quantity}
		     , UOM = #{uom}
		     , UNIT_PRICE = #{unitPrice}
			 , CURRENCY = #{currency}
			 , AMOUNT = #{amount}
			 , DEL_YN = 'N'
	</insert>

	<!-- <insert id="insertPackingListMainList" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO EXPORT_MAIN(
		 SHIPPER,
		 INVOICE_NO,
		 INVOICE_DATE,
		 CONSIGNEE,
		 MANUFACT,
		 PL_LOADPORT,
		 PL_FLIGHT,
		 PL_DESTINATION,
		 PL_DEPDATE,
		 TOTAL_QUANTITY,
		 TOTAL_NET,
		 TOTAL_GROSS,
		 TOTAL_KG,
		 DEL_YN,
		 REG_DT,
		 REG_ID
		)VALUES(
			#{shipper},
			#{invoiceNo},
			#{invoiceDate},
			#{consignee},
			#{manufact},
			#{plLoadPort},
			#{plFlight},
			#{plDestination},
			#{plDepDate},
			#{totalQuantity},
			#{totalNet},
			#{totalGross},
			#{totalKg},
			'N',
			DATE_FORMAT(NOW(), '%Y%m%d'),
	  		#{regId}
	  		) ON DUPLICATE KEY
			UPDATE EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d')
			 , EDT_ID = #{edtId}
			 , SHIPPER = #{shipper}
			 , INVOICE_NO = #{invoiceNo}
			 , INVOICE_DATE = #{invoiceDate}
			 , CONSIGNEE  = #{consignee}
			 , LOADPORT = #{plLoadPort}
			 , FLIGHT = #{plFlight}
			 , PL_DEPDATE = #{plDepDate}
			 , PL_DESTINATION = ''
			 , MANUFACT = ''
			 , TOTAL_QUANTITY = #{totalQuantity}
			 , TOTAL_NET = #{totalNet}
			 , TOTAL_GROSS = #{totalGross}
			 , TOTAL_KG = #{totalKg}
			 , DEL_YN = 'N'
	</insert> -->
	
	<update id="updateManufactPackList" parameterType="searchVO">
		UPDATE EXPORT_MAIN
		SET MANUFACT = #{srch1}
		, PL_LOADPORT = #{srch2}
		, PL_DESTINATION = #{srch3}
		, PL_DEPDATE = #{srch4}
		, PL_FLIGHT = #{srch5}
		, TOTAL_QUANTITY = #{srch6}
		, TOTAL_NET = #{srch7}
		, TOTAL_GROSS = #{srch8}
		, TOTAL_KG = #{srch9}
		, TOTAL_CNT = #{srch11}
		, COMMENTS = #{srch12}
		WHERE INVOICE_NO = #{srch10};
	</update>
	
	<update id="updateTempManufactPlList" parameterType="searchVO">
		UPDATE EXPORT_MAIN_TEMP
		SET MANUFACT = #{srch1}
		, PL_LOADPORT = #{srch2}
		, PL_DESTINATION = #{srch3}
		, PL_DEPDATE = #{srch4}
		, PL_FLIGHT = #{srch5}
		, TOTAL_QUANTITY = #{srch6}
		, TOTAL_NET = #{srch7}
		, TOTAL_GROSS = #{srch8}
		, TOTAL_KG = #{srch9}
		, TOTAL_CNT = #{srch11}
		, COMMENTS = #{srch12}
		WHERE INVOICE_NO = #{srch10};
	</update>
	
	<select id="selectTempPlMainIdex"  parameterType="egovframework.pf.exp.service.SaveExpMainVO" resultType="String">
		SELECT MAIN_SEQ
		FROM EXPORT_MAIN_TEMP
		WHERE INVOICE_NO = #{srch10}
	</select>
	
	<select id="selectPackingListMainIdex"  parameterType="egovframework.pf.exp.service.SaveExpMainVO" resultType="String">
		SELECT MAIN_SEQ
		FROM EXPORT_MAIN
		WHERE INVOICE_NO = #{srch10}
	</select>
	
	<insert id="insertPackingListSubList" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO EXPORT_CT(
		 MAIN_SEQ,
		 CT_NUMBER,
		 HS_CODE,
		 GENERAL_NAME,
		 GOODS_DESCRIPTION,
		 NATION,
		 QUANTITY,
		 UOM,
		 NET_WEIGHT,
		 GROSS_WEIGHT,
		 KG,
		 DEL_YN,
		 REG_DT,
		 REG_ID,
		 EDT_DT,
		 EDT_ID
		)VALUES(
			#{mainIndex},
			#{ctNo},
			#{plHsCode},
			#{plItemName},
			#{plGoodDes},
			#{plNation},
			#{plQuantity},
			#{plUom},
			#{net},
			#{gross},
			#{kg},
			'N',
			DATE_FORMAT(NOW(), '%Y%m%d'),
	  		#{regId},
	  		'N',
	  		'N'
	  		) ON DUPLICATE KEY
			UPDATE EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d')
			 , EDT_ID = #{edtId}
			 , CT_NUMBER = #{ctNo}
			 , HS_CODE = #{plHsCode}
			 , GENERAL_NAME = #{plItemName}
			 , GOODS_DESCRIPTION = #{plGoodDes}
			 , NATION = #{plNation}
			 , QUANTITY = #{plQuantity}
		     , UOM = #{plUom}
		     , NET_WEIGHT = #{net}
		     , GROSS_WEIGHT = #{gross}
		     , KG = #{kg}
			 , DEL_YN = 'N'
	</insert>
	
	<insert id="saveTempExpMakePlSubList" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO EXPORT_CT_TEMP(
		 MAIN_SEQ,
		 CT_NUMBER,
		 HS_CODE,
		 GENERAL_NAME,
		 GOODS_DESCRIPTION,
		 NATION,
		 QUANTITY,
		 UOM,
		 NET_WEIGHT,
		 GROSS_WEIGHT,
		 KG,
		 DEL_YN,
		 REG_DT,
		 REG_ID,
		 EDT_DT,
		 EDT_ID
		)VALUES(
			#{mainIndex},
			#{ctNo},
			#{plHsCode},
			#{plItemName},
			#{plGoodDes},
			#{plNation},
			#{plQuantity},
			#{plUom},
			#{net},
			#{gross},
			#{kg},
			'N',
			DATE_FORMAT(NOW(), '%Y%m%d'),
	  		#{regId},
	  		'N',
	  		'N'
	  		) ON DUPLICATE KEY
			UPDATE EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d')
			 , EDT_ID = #{edtId}
			 , CT_NUMBER = #{ctNo}
			 , HS_CODE = #{plHsCode}
			 , GENERAL_NAME = #{plItemName}
			 , GOODS_DESCRIPTION = #{plGoodDes}
			 , NATION = #{plNation}
			 , QUANTITY = #{plQuantity}
		     , UOM = #{plUom}
		     , NET_WEIGHT = #{net}
		     , GROSS_WEIGHT = #{gross}
		     , KG = #{kg}
			 , DEL_YN = 'N'
	</insert>
	
	<!-- 수출신고 현황 목록 조회 -->
	<select id="selectExportViewList" parameterType="searchVO" resultType="egovMap">
		SELECT
			COUNT(*) over() AS cnt,
			sn,
		    rece,
		    rece_result,
		    rpt_no,
		    exp_firm,
		    buy_firm,
		    Ta_St_iso,
		    reporter,
		    rpt_Day,
		    Exp_Lis_Day,
		    Juk_Day,
		    ship_day,
		    Exc_Cot,
		    Con_MetNm,
		    amt,
		    tot_pack_cnt,
		    tot_wt,
		    state
		FROM (
			SELECT
			a.sn,
		    a.rece,
		    a.rece_result,
		    CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', SUBSTRING(a.rpt_no, 6, 2), '-', SUBSTRING(a.rpt_no, 8, 7)) AS rpt_no,
		    a.exp_firm,
		    a.buy_firm,
		    a.Ta_St_iso,
		    IFNULL(I.cmmn_nm,'타관세법인') AS reporter,
		    CASE WHEN a.Rpt_Day != '' THEN DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') ELSE '' END AS rpt_Day,
		    CASE WHEN a.Exp_Lis_Day != '' THEN DATE_FORMAT(a.Exp_Lis_Day, '%Y-%m-%d') ELSE '' END AS Exp_Lis_Day,
		    CASE WHEN a.Juk_Day != '' THEN DATE_FORMAT(a.Juk_Day, '%Y-%m-%d') ELSE '' END AS Juk_Day,
		    case when a.ship_day IS NULL then '-' 
		    	 when a.ship_day = '' then '-'
			ELSE DATE_FORMAT(a.ship_day, '%Y-%m-%d') end as ship_day,
		    CONCAT(a.Exc_Divi, '-', a.Exc_DiviNm) AS Exc_Cot,
		    a.Con_MetNm,
		    FORMAT(a.amt, 2) AS amt,
		    CONCAT(a.Tot_Pack_Cnt, ' (', a.tot_pack_ut, ')') AS tot_pack_cnt,
		    CONCAT(a.Tot_Wt, ' (', a.ut, ')') AS tot_wt,
		    IFNULL(C.STATE,'0') AS state
			FROM 
			    cusdec830a1selrdy a
			    LEFT JOIN
				(select cmmn_cd, cmmn_nm from cmmn_cd where grp_cd = 'EXPSHRPTCD') I
				on I.cmmn_cd = SUBSTRING(a.rpt_no, 1, 5)
				LEFT JOIN 
		 		co_request C ON 
		 		C.CORP_NO = A.EXP_SDNO
		 		<!-- AND C.CMPNY_NM = A.COMM_FIRM -->
		 		AND C.RPT_NO = A.RPT_NO
			   <!--  AND B.mg_code = C.INVOICE_NO
	     		AND B.rpt_no = C.RPT_NO -->
				WHERE 
				    A.rpt_seq = '00'
		    <choose>
		    <when test="srch1 =='02'">
		    AND CONVERT(a.rece USING utf8mb4) = '수리'
		    </when>
		    <when test="srch1 =='03'">
		    AND CONVERT(a.rece USING utf8mb4) NOT IN ('수리', '승인')
		    </when>
		    <when test="srch1 == '04'">
			AND CONVERT(a.rece USING utf8mb4) = ''
			</when>
			<when test="srch1 == '05'">
			AND CONVERT(a.rece USING utf8mb4) != ''
			</when>
		    </choose>
		    <choose>
			<when test="srch9 == 1">
			AND CONVERT(a.rece USING utf8mb4) IN ('의뢰', '')			
			</when>
			<when test="srch9 == 2">
			AND CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제')	
			</when>
			<when test="srch9 == 3">
			AND CONVERT(a.rece USING utf8mb4) = '미결'			
			</when>
			<when test="srch9 == 4">
			AND CONVERT(a.rece USING utf8mb4) = '완료'			
			</when>
			<when test="srch9 == 5">
			AND a.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') 
			</when>
			</choose>
			<if test="srch9 != 5">
             <choose>
                 <when test="srch8 == '01'">
                     AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </when>
                 <otherwise>
                     AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </otherwise>
             </choose>
         	</if>
			<if test="srch4 != null and srch4 != ''">
			AND a.rpt_no LIKE CONCAT('%',UPPER(REPLACE(#{srch4},'-','')),'%')
			</if>
			<if test="srch5 != null and srch5 != ''">
			AND a.rpt_no IN (SELECT DISTINCT RPT_NO FROM cusdec830b1selrdy WHERE mg_code like CONCAT('%',UPPER(#{srch5}),'%'))
			</if>
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
        	
        	UNION
        	
        	SELECT
			a.sn,
		    a.rece,
		    a.rece_result,
		    CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', SUBSTRING(a.rpt_no, 6, 2), '-', SUBSTRING(a.rpt_no, 8, 7)) AS rpt_no,
		    a.exp_firm,
		    a.buy_firm,
		    a.Ta_St_iso,
		    IFNULL(I.cmmn_nm,'타관세법인') AS reporter,
		    CASE WHEN a.Rpt_Day != '' THEN DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') ELSE '' END AS rpt_Day,
		    CASE WHEN a.Exp_Lis_Day != '' THEN DATE_FORMAT(a.Exp_Lis_Day, '%Y-%m-%d') ELSE '' END AS Exp_Lis_Day,
		    CASE WHEN a.Juk_Day != '' THEN DATE_FORMAT(a.Juk_Day, '%Y-%m-%d') ELSE '' END AS Juk_Day,
		    case when a.ship_day IS NULL then '-' 
		    	 when a.ship_day = '' then '-'
			ELSE DATE_FORMAT(a.ship_day, '%Y-%m-%d') end as ship_day,
		    CONCAT(a.Exc_Divi, '-', a.Exc_DiviNm) AS Exc_Cot,
		    a.Con_MetNm,
		    FORMAT(a.amt, 2) AS amt,
		    CONCAT(a.Tot_Pack_Cnt, ' (', a.tot_pack_ut, ')') AS tot_pack_cnt,
		    CONCAT(a.Tot_Wt, ' (', a.ut, ')') AS tot_wt,
			IFNULL(C.STATE,'0') AS state
			
			FROM 
			    cusdec830a1icnrdy a
			    LEFT JOIN
				(select cmmn_cd, cmmn_nm from cmmn_cd where grp_cd = 'EXPSHRPTCD') I
				on I.cmmn_cd = SUBSTRING(a.rpt_no, 1, 5)
		 	LEFT JOIN 
	 		co_request C ON 
	 		C.CORP_NO = A.EXP_SDNO
	 		<!-- AND C.CMPNY_NM = A.COMM_FIRM -->
	 		AND C.RPT_NO = A.RPT_NO
		    <!-- AND B.mg_code = C.INVOICE_NO
     		AND B.rpt_no = C.RPT_NO -->
			WHERE 
			    A.rpt_seq = '00'
		    <choose>
		    <when test="srch1 =='02'">
		    AND CONVERT(a.rece USING utf8mb4) = '수리'
		    </when>
		    <when test="srch1 =='03'">
		    AND CONVERT(a.rece USING utf8mb4) NOT IN ('수리', '승인')
		    </when>
		    <when test="srch1 == '04'">
			AND CONVERT(a.rece USING utf8mb4) = ''
			</when>
			<when test="srch1 == '05'">
			AND CONVERT(a.rece USING utf8mb4) != ''
			</when>
		    </choose>
		    <choose>
			<when test="srch9 == 1">
			AND CONVERT(a.rece USING utf8mb4) IN ('의뢰', '')	
			</when>
			<when test="srch9 == 2">
			AND CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제')	
			</when>
			<when test="srch9 == 3">
			AND CONVERT(a.rece USING utf8mb4) = '미결'
			</when>
			<when test="srch9 == 4">
			AND CONVERT(a.rece USING utf8mb4) = '완료'
			</when>
			<when test="srch9 == 5">
			AND a.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d')
			AND a.rpt_seq = '00'
			</when>
			</choose>
			<if test="srch9 != 5">
             <choose>
                 <when test="srch8 == '01'">
                     AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </when>
                 <otherwise>
                     AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </otherwise>
             </choose>
         	</if>

			<!-- <choose>
		    <when test="srch8 =='01'">
		    AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </when>
		    <otherwise>
		    AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </otherwise>
		    </choose> -->
			<if test="srch4 != null and srch4 != ''">
			AND a.rpt_no LIKE CONCAT('%',UPPER(REPLACE(#{srch4},'-','')),'%')
			</if>
			<if test="srch5 != null and srch5 != ''">
			AND a.rpt_no IN (SELECT DISTINCT RPT_NO FROM cusdec830b1icnrdy WHERE mg_code like CONCAT('%',UPPER(#{srch5}),'%'))
			</if>
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
        	
        	UNION
        	
        	SELECT
			a.sn,
		    a.rece,
		    a.rece_result,
		    CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', SUBSTRING(a.rpt_no, 6, 2), '-', SUBSTRING(a.rpt_no, 8, 7)) AS rpt_no,
		    a.exp_firm,
		    a.buy_firm,
		    a.Ta_St_iso,
		    IFNULL(I.cmmn_nm,'타관세법인') AS reporter,
		    CASE WHEN a.Rpt_Day != '' THEN DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') ELSE '' END AS rpt_Day,
		    CASE WHEN a.Exp_Lis_Day != '' THEN DATE_FORMAT(a.Exp_Lis_Day, '%Y-%m-%d') ELSE '' END AS Exp_Lis_Day,
		    CASE WHEN a.Juk_Day != '' THEN DATE_FORMAT(a.Juk_Day, '%Y-%m-%d') ELSE '' END AS Juk_Day,
		    case when a.ship_day IS NULL then '-' 
		    	 when a.ship_day = '' then '-'
			ELSE DATE_FORMAT(a.ship_day, '%Y-%m-%d') end as ship_day,
		    CONCAT(a.Exc_Divi, '-', a.Exc_DiviNm) AS Exc_Cot,
		    a.Con_MetNm,
		    FORMAT(a.amt, 2) AS amt,
		    CONCAT(a.Tot_Pack_Cnt, ' (', a.tot_pack_ut, ')') AS tot_pack_cnt,
		    CONCAT(a.Tot_Wt, ' (', a.ut, ')') AS tot_wt,
		    IFNULL(C.STATE,'0') AS state
			FROM 
			    cusdec830a1airrdy a
			    LEFT JOIN
				(select cmmn_cd, cmmn_nm from cmmn_cd where grp_cd = 'EXPSHRPTCD') I
				on I.cmmn_cd = SUBSTRING(a.rpt_no, 1, 5)
			 	LEFT JOIN 
		 		co_request C ON 
		 		C.CORP_NO = A.EXP_SDNO
		 		<!-- AND C.CMPNY_NM = A.COMM_FIRM -->
		 		AND C.RPT_NO = A.RPT_NO
			   <!--  AND B.mg_code = C.INVOICE_NO
	     		AND B.rpt_no = C.RPT_NO -->
			WHERE 
			    A.rpt_seq = '00'
		    <choose>
		    <when test="srch1 =='02'">
		    AND CONVERT(a.rece USING utf8mb4) = '수리'
		    </when>
		    <when test="srch1 =='03'">
		    AND CONVERT(a.rece USING utf8mb4) NOT IN ('수리', '승인')
		    </when>
		    <when test="srch1 == '04'">
			AND CONVERT(a.rece USING utf8mb4) = ''
			</when>
			<when test="srch1 == '05'">
			AND CONVERT(a.rece USING utf8mb4) != ''
			</when>
		    </choose>
		    <choose>
			<when test="srch9 == 1">
			AND CONVERT(a.rece USING utf8mb4) IN ('의뢰', '')			
			</when>
			<when test="srch9 == 2">
			AND CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제')	
			</when>
			<when test="srch9 == 3">
			AND CONVERT(a.rece USING utf8mb4) = '미결'			
			</when>
			<when test="srch9 == 4">
			AND CONVERT(a.rece USING utf8mb4) = '완료'			
			</when>
			<when test="srch9 == 5">
			AND a.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d')
			</when>
			</choose>
			<if test="srch9 != 5">
             <choose>
                 <when test="srch8 == '01'">
                     AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </when>
                 <otherwise>
                     AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </otherwise>
             </choose>
         	</if>


			<!-- <choose>
		    <when test="srch8 =='01'">
		    AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </when>
		    <otherwise>
		    AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </otherwise>
		    </choose> -->
			<if test="srch4 != null and srch4 != ''">
			AND a.rpt_no LIKE CONCAT('%',UPPER(REPLACE(#{srch4},'-','')),'%')
			</if>
			<if test="srch5 != null and srch5 != ''">
			AND a.rpt_no IN (SELECT DISTINCT RPT_NO FROM cusdec830b1airrdy WHERE mg_code like CONCAT('%',UPPER(#{srch5}),'%'))
			</if>
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
        	
        	UNION
        	
        	SELECT
			a.sn,
		    a.rece,
		    a.rece_result,
		    CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', SUBSTRING(a.rpt_no, 6, 2), '-', SUBSTRING(a.rpt_no, 8, 7)) AS rpt_no,
		    a.exp_firm,
		    a.buy_firm,
		    a.Ta_St_iso,
		    IFNULL(I.cmmn_nm,'타관세법인') AS reporter,
		    CASE WHEN a.Rpt_Day != '' THEN DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') ELSE '' END AS rpt_Day,
		    CASE WHEN a.Exp_Lis_Day != '' THEN DATE_FORMAT(a.Exp_Lis_Day, '%Y-%m-%d') ELSE '' END AS Exp_Lis_Day,
		    CASE WHEN a.Juk_Day != '' THEN DATE_FORMAT(a.Juk_Day, '%Y-%m-%d') ELSE '' END AS Juk_Day,
		    case when a.ship_day IS NULL then '-' 
		    	 when a.ship_day = '' then '-'
			ELSE DATE_FORMAT(a.ship_day, '%Y-%m-%d') end as ship_day,
		    CONCAT(a.Exc_Divi, '-', a.Exc_DiviNm) AS Exc_Cot,
		    a.Con_MetNm,
		    FORMAT(a.amt, 2) AS amt,
		    CONCAT(a.Tot_Pack_Cnt, ' (', a.tot_pack_ut, ')') AS tot_pack_cnt,
		    CONCAT(a.Tot_Wt, ' (', a.ut, ')') AS tot_wt,
		    IFNULL(C.STATE,'0') AS state
			FROM 
			    cusdec830a1bsnrdy a
			    LEFT JOIN
				(select cmmn_cd, cmmn_nm from cmmn_cd where grp_cd = 'EXPSHRPTCD') I
				on I.cmmn_cd = SUBSTRING(a.rpt_no, 1, 5)
				LEFT JOIN 
		 		co_request C ON 
		 		C.CORP_NO = A.EXP_SDNO
		 		<!-- AND C.CMPNY_NM = A.COMM_FIRM -->
		 		AND C.RPT_NO = A.RPT_NO
			   <!--  AND B.mg_code = C.INVOICE_NO
	     		AND B.rpt_no = C.RPT_NO -->
				WHERE 
				    A.rpt_seq = '00'
		    <choose>
		    <when test="srch1 =='02'">
		    AND CONVERT(a.rece USING utf8mb4) = '수리'
		    </when>
		    <when test="srch1 =='03'">
		    AND CONVERT(a.rece USING utf8mb4) NOT IN ('수리', '승인')
		    </when>
		    <when test="srch1 == '04'">
			AND CONVERT(a.rece USING utf8mb4) = ''
			</when>
			<when test="srch1 == '05'">
			AND CONVERT(a.rece USING utf8mb4) != ''
			</when>
		    </choose>
		    <choose>
			<when test="srch9 == 1">
			AND CONVERT(a.rece USING utf8mb4) IN ('의뢰', '')			
			</when>
			<when test="srch9 == 2">
			AND CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제')	
			</when>
			<when test="srch9 == 3">
			AND CONVERT(a.rece USING utf8mb4) = '미결'			
			</when>
			<when test="srch9 == 4">
			AND CONVERT(a.rece USING utf8mb4) = '완료'			
			</when>
			<when test="srch9 == 5">
			AND a.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d')
			</when>
			</choose>
			<!-- <choose>
		    <when test="srch8 =='01'">
		    AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </when>
		    <otherwise>
		    AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </otherwise>
		    </choose> -->
		    <if test="srch9 != 5">
             <choose>
                 <when test="srch8 == '01'">
                     AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </when>
                 <otherwise>
                     AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </otherwise>
             </choose>
         	</if>

			<if test="srch4 != null and srch4 != ''">
			AND a.rpt_no LIKE CONCAT('%',UPPER(REPLACE(#{srch4},'-','')),'%')
			</if>
			<if test="srch5 != null and srch5 != ''">
			AND a.rpt_no IN (SELECT DISTINCT RPT_NO FROM cusdec830b1bsnrdy WHERE mg_code like CONCAT('%',UPPER(#{srch5}),'%'))
			</if>
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
        	
        	UNION
        	
        	SELECT
			a.TE1_001 AS sn,
		    a.TE1_098 AS rece,
		    a.TE1_036 AS rece_result,
		    CONCAT(SUBSTRING(a.TE1_032, 1, 5), '-', SUBSTRING(a.TE1_032, 6, 2), '-', SUBSTRING(a.TE1_032, 8, 7)) AS rpt_no,
		    a.TE1_122 AS exp_firm,
		    a.TE1_024 AS buy_firm,
		    a.TE1_040 AS Ta_St_iso,
		    IFNULL(I.cmmn_nm,'타관세법인') AS reporter,
		    CASE WHEN a.TE1_034 != '' THEN DATE_FORMAT(a.TE1_034, '%Y-%m-%d') ELSE '' END AS rpt_Day,
		    CASE WHEN a.TE1_095 != '' THEN DATE_FORMAT(a.TE1_095, '%Y-%m-%d') ELSE '' END AS Exp_Lis_Day,
		    CASE WHEN a.TE1_117 != '' THEN DATE_FORMAT(a.TE1_117, '%Y-%m-%d') ELSE '' END AS Juk_Day,
		    case when a.TE1_142 IS NULL then '-' 
		    	 when a.TE1_142 = '' then '-'
			ELSE DATE_FORMAT(a.TE1_142, '%Y-%m-%d') end as ship_day,
		    a.TE1_037 AS Exc_Cot,
		    '' AS Con_MetNm,
		    0 AS amt,
		    CONCAT(a.TE1_055, ' (', a.TE1_133, ')') AS tot_pack_cnt,
		    a.TE1_053 AS tot_wt,
		    IFNULL(C.STATE,'0') AS state
			FROM 
			    temp_export1bsnenc a
			    LEFT JOIN
				(select cmmn_cd, cmmn_nm from cmmn_cd where grp_cd = 'EXPSHRPTCD') I
				on I.cmmn_cd = SUBSTRING(a.TE1_032, 1, 5)
			 	LEFT JOIN 
		 		co_request C ON 
		 		C.CORP_NO = A.TE1_126
		 		<!-- AND C.CMPNY_NM = A.COMM_FIRM -->
		 		AND C.RPT_NO = A.TE1_001
			   <!--  AND B.mg_code = C.INVOICE_NO
	     		AND B.rpt_no = C.RPT_NO -->
				WHERE 1=1
		    <choose>
		    <when test="srch1 =='02'">
		    AND A.TE1_098 = '수리'
		    </when>
		    <when test="srch1 =='03'">
		    AND A.TE1_098 NOT IN ('수리', '승인')
		    </when>
		    <when test="srch1 == '04'">
			AND A.TE1_098 = ''
			</when>
			<when test="srch1 == '05'">
			AND A.TE1_098 != ''
			</when>
		    </choose>
		    <choose>
			<when test="srch9 == 1">
			AND CONVERT(a.TE1_098 USING utf8mb4) IN ('의뢰', '')			
			</when>
			<when test="srch9 == 2">
			AND CONVERT(a.TE1_098 USING utf8mb4) IN ('접수', '검사', '제출', '전제')	
			</when>
			<when test="srch9 == 3">
			AND CONVERT(a.TE1_098 USING utf8mb4) = '미결'			
			</when>
			<when test="srch9 == 4">
			AND CONVERT(a.TE1_098 USING utf8mb4) = '완료'			
			</when>
			<when test="srch9 == 5">
			AND a.TE1_142 = DATE_FORMAT(CURDATE(), '%Y%m%d')
			</when>
			</choose>
			<if test="srch9 != 5">
             <choose>
                 <when test="srch8 == '01'">
                     AND A.TE1_034 BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </when>
                 <otherwise>
                     AND A.TE1_095 BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
                 </otherwise>
             </choose>
         	</if>
			<if test="srch4 != null and srch4 != ''">
			AND a.TE1_032 LIKE CONCAT('%',UPPER(REPLACE(#{srch4},'-','')),'%')
			</if>
			<if test="srch5 != null and srch5 != ''">
			AND a.TE1_001 IN (SELECT DISTINCT TE1_001 FROM temp_export2bsnenc WHERE TE2_005 like CONCAT('%',UPPER(#{srch5}),'%'))
			</if>
			<if test="list != null and list.size() > 0">
	            AND a.TE1_126 IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
		) AS EXPORT
		WHERE 1=1
			<if test="srchType1 != null and srchType1 != '' and srchText1 != null and srchText1 != ''">
			AND ${srchType1} LIKE CONCAT('%',UPPER(#{srchText1}),'%')
			</if>
			<if test="srchType2 != null and srchType2 != '' and srchText2 != null and srchText2 != ''">
			AND ${srchType2} LIKE CONCAT('%',UPPER(#{srchText2}),'%')
			</if>
			ORDER BY rpt_day desc, rpt_no desc
			LIMIT #{recordCountPerPage} OFFSET #{startPage};
	 </select>
	
	 <!-- 수출신고 현황 상세 란 목록 조회 -->
	 <select id="selectExportViewLanList" parameterType="searchVO" resultType="egovMap">
		SELECT 
			RPT_NO,
			RAN_NO,
			HS,
			Exc_Gnm,
			Con_Amt,
			Sun_Wt,
			Pack_Cnt,
			Ori_st_mark1,
			invoice,
			Att_yn,
			incorterms
		FROM (
		SELECT 
			RPT_NO,
			RAN_NO,
			CONCAT(SUBSTRING(HS, 1, 4), '.', SUBSTRING(HS, 5, 2), '-', SUBSTRING(HS, 7, 4)) AS HS,
			Exc_Gnm,
			Con_Amt,
			Sun_Wt,
			Pack_Cnt,
			Ori_st_mark1,
			mg_code AS invoice,
			Att_yn,
			amt_cod AS incorterms
		FROM cusdec830b1selrdy
			WHERE rpt_no = #{srch4}
			AND rpt_seq = '00'
			
			UNION
			
			SELECT 
			RPT_NO,
			RAN_NO,
			CONCAT(SUBSTRING(HS, 1, 4), '.', SUBSTRING(HS, 5, 2), '-', SUBSTRING(HS, 7, 4)) AS HS,
			Exc_Gnm,
			Con_Amt,
			Sun_Wt,
			Pack_Cnt,
			Ori_st_mark1,
			mg_code AS invoice,
			Att_yn,
			amt_cod AS incorterms
		FROM cusdec830b1airrdy
			WHERE rpt_no = #{srch4}
			AND rpt_seq = '00'
			
			UNION
			
			SELECT 
			RPT_NO,
			RAN_NO,
			CONCAT(SUBSTRING(HS, 1, 4), '.', SUBSTRING(HS, 5, 2), '-', SUBSTRING(HS, 7, 4)) AS HS,
			Exc_Gnm,
			Con_Amt,
			Sun_Wt,
			Pack_Cnt,
			Ori_st_mark1,
			mg_code AS invoice,
			Att_yn,
			amt_cod AS incorterms
		FROM cusdec830b1icnrdy
			WHERE rpt_no = #{srch4}
			AND rpt_seq = '00'
			
			UNION
			
			SELECT 
			RPT_NO,
			RAN_NO,
			CONCAT(SUBSTRING(HS, 1, 4), '.', SUBSTRING(HS, 5, 2), '-', SUBSTRING(HS, 7, 4)) AS HS,
			Exc_Gnm,
			Con_Amt,
			Sun_Wt,
			Pack_Cnt,
			Ori_st_mark1,
			mg_code AS invoice,
			Att_yn,
			amt_cod AS incorterms
		FROM cusdec830b1bsnrdy
			WHERE rpt_no = #{srch4}
			AND rpt_seq = '00'
			
			UNION
			
			SELECT 
			TE2_001 AS RPT_NO,
			TE2_002 AS RAN_NO,
			CONCAT(SUBSTRING(TE2_004, 1, 4), '.', SUBSTRING(TE2_004, 5, 2), '-', SUBSTRING(TE2_004, 7, 4)) AS HS,
			TE2_015 AS Exc_Gnm,
			TE2_018 AS Con_Amt,
			TE2_006 AS Sun_Wt,
			TE2_010 AS Pack_Cnt,
			TE2_027 AS Ori_st_mark1,
			TE2_005 AS invoice,
			'' AS Att_yn,
			'' AS incorterms
		FROM temp_export2bsnenc
			WHERE TE2_001 = #{srch3}
			
			) A
			WHERE 1=1
			ORDER BY RPT_NO, RAN_NO;
	</select>
	
	<select id="selectExportViewLanListExcel" parameterType="searchVO" resultType="egovMap">
		SELECT 
			RPT_NO,
			RAN_NO,
			CONCAT(SUBSTRING(HS, 1, 4), '.', SUBSTRING(HS, 5, 2), '-', SUBSTRING(HS, 7, 4)) AS HS,
			Exc_Gnm,
			Con_Amt,
			Sun_Wt,
			Pack_Cnt,
			Ori_st_mark1,
			mg_code AS invoice,
			Att_yn
		FROM cusdec830b1
		WHERE rpt_no IN (
			SELECT RPT_NO FROM CUSDEC830A1 A
			WHERE A.rpt_seq = '00'
		    <choose>
		    <when test="srch1 =='02'">
		    AND A.rece = '수리'
		    </when>
		    <when test="srch1 =='03'">
		    AND A.rece NOT IN ('수리', '승인')
		    </when>
		    <when test="srch1 =='04'">
		    AND A.rece = '승인'
		    </when>
		    </choose>
			<choose>
		    <when test="srch8 =='01'">
		    AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </when>
		    <otherwise>
		    AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </otherwise>
		    </choose>
			<if test="srch4 != null and srch4 != ''">
			AND a.rpt_no LIKE CONCAT('%',UPPER(REPLACE(#{srch4},'-','')),'%')
			</if>
			<if test="srch5 != null and srch5 != ''">
			AND b.mg_code LIKE CONCAT('%',UPPER(#{srch5}),'%')
			</if>
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
		)
		AND rpt_seq = '00'
		ORDER BY rpt_no, ran_no;
	</select>

	<!-- 수출신고 현황 상세 규격 목록 조회 -->
	<select id="selectExportViewSpecList" parameterType="searchVO" resultType="egovMap">
		SELECT
			RPT_NO,
			RAN_NO, 
			Sil,
			Gnm1, 
			Qty, 
			Price, 
			Amt,
			Gnm2, 
			Gnm3, 
			Gnm4, 
			Gnm5
		FROM (
		SELECT
			RPT_NO,
			RAN_NO, 
			Sil,
			Gnm1, 
			Qty, 
			Price, 
			Amt,
			Gnm2, 
			Gnm3, 
			Gnm4, 
			Gnm5
		FROM cusdec830c1selrdy
		WHERE rpt_no = #{srch4}
		AND RAN_NO = #{srch6}
		AND rpt_seq = '00'
		
		UNION
		
		SELECT
			RPT_NO,
			RAN_NO, 
			Sil,
			Gnm1, 
			Qty, 
			Price, 
			Amt,
			Gnm2, 
			Gnm3, 
			Gnm4, 
			Gnm5
		FROM cusdec830c1icnrdy
		WHERE rpt_no = #{srch4}
		AND RAN_NO = #{srch6}
		AND rpt_seq = '00'
		
		UNION
		
		SELECT
			RPT_NO,
			RAN_NO, 
			Sil,
			Gnm1, 
			Qty, 
			Price, 
			Amt,
			Gnm2, 
			Gnm3, 
			Gnm4, 
			Gnm5
		FROM cusdec830c1airrdy
		WHERE rpt_no = #{srch4}
		AND RAN_NO = #{srch6}
		AND rpt_seq = '00'
		
		UNION
		
		SELECT
			RPT_NO,
			RAN_NO, 
			Sil,
			Gnm1, 
			Qty, 
			Price, 
			Amt,
			Gnm2, 
			Gnm3, 
			Gnm4, 
			Gnm5
		FROM cusdec830c1bsnrdy
		WHERE rpt_no = #{srch4}
		AND RAN_NO = #{srch6}
		AND rpt_seq = '00'
		
		UNION
		
		SELECT
		TE3_001 AS RPT_NO,  
		TE3_002 AS RAN_NO,  
		TE3_003 AS Sil,     
		TE3_016 AS Gnm1,    
		TE3_007 As Qty,    
		TE3_015 AS Price,   
		TE3_013 AS Amt,     
		TE3_017 AS Gnm2,   
		TE3_018 AS Gnm3,   
		TE3_019 AS Gnm4,   
		TE3_020 AS Gnm5    
		FROM temp_export3bsnenc
		WHERE TE3_001 = #{srch3}
		AND TE3_002 = #{srch6}
		) A
		WHERE 1=1
		ORDER BY RPT_NO, RAN_NO, SIL;
	</select>
	
	<!-- 수출신고 현황 상세 규격 목록 조회 -->
	<select id="selectExportViewSpecListExcel" parameterType="searchVO" resultType="egovMap">
		SELECT
			RPT_NO,
			RAN_NO, 
			Sil,
			Gnm1, 
			Qty, 
			Price, 
			Amt,
			Gnm2, 
			Gnm3, 
			Gnm4, 
			Gnm5
			FROM cusdec830c1
			WHERE rpt_no IN (
			SELECT RPT_NO 
		FROM CUSDEC830A1 A
		WHERE 
		    A.rpt_seq = '00'
		    <choose>
		    <when test="srch1 =='02'">
		    AND A.rece = '수리'
		    </when>
		    <when test="srch1 =='03'">
		    AND A.rece NOT IN ('수리', '승인')
		    </when>
		    <when test="srch1 =='04'">
		    AND A.rece = '승인'
		    </when>
		    </choose>
			<choose>
		    <when test="srch8 =='01'">
		    AND A.rpt_day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </when>
		    <otherwise>
		    AND A.exp_Lis_Day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		    </otherwise>
		    </choose>
			<if test="srch4 != null and srch4 != ''">
			AND a.rpt_no LIKE CONCAT('%',UPPER(REPLACE(#{srch4},'-','')),'%')
			</if>
			<if test="srch5 != null and srch5 != ''">
			AND b.mg_code LIKE CONCAT('%',UPPER(#{srch5}),'%')
			</if>
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
		)
		AND rpt_seq = '00'
		ORDER BY rpt_no, ran_no, sil;
	</select>
	
	<select id="selectExportUpdateList" parameterType="searchVO" resultType="egovMap">
		SELECT 
		    COUNT(*) OVER() AS CNT,
		    sn,
		    rece,
		    expName,
		    invoice,
		    expRptNo,
		    modiSeq,
		    rptDay,
		    dptDay, 
		    modiCot1, 
		    customs,
		    lisDay,
		    plant,
		    so
		FROM (
		    SELECT
		    	A.sn AS sn,
		    	B.exp_sdno AS exp_sdno,
		        A.rece AS rece,
		        A.exp_name AS expName,
		        C.invoice AS invoice,
		        CONCAT(SUBSTRING(A.exp_rpt_no, 1, 5), '-', SUBSTRING(A.exp_rpt_no, 6, 2), '-', SUBSTRING(A.exp_rpt_no, 8)) AS expRptNo,
		        A.modi_seq AS modiSeq,
		        (CASE WHEN A.rpt_day IS NULL OR A.rpt_day = '' THEN '' ELSE DATE_FORMAT(STR_TO_DATE(A.rpt_day, '%Y%m%d'), '%Y-%m-%d') END) AS rptDay,
		        (CASE WHEN A.dpt_day IS NULL OR A.dpt_day = '' THEN '' ELSE DATE_FORMAT(STR_TO_DATE(A.dpt_day, '%Y%m%d'), '%Y-%m-%d') END) AS dptDay, 
		        A.modi_cot1 AS modiCot1,
		        E.Cont AS customs, 
		        (CASE WHEN A.lis_day IS NULL OR A.lis_day = '' THEN '' ELSE DATE_FORMAT(STR_TO_DATE(A.lis_day, '%Y%m%d'), '%Y-%m-%d') END) AS lisDay,
		        B.plant AS plant,
		        B.so AS so
		    FROM (
		        SELECT
		            sn, 
		            exp_rpt_no, 
		            branch, 
		            exp_name,
		            cus_prg,  
		            cus, 
		            lis_day, 
		            rpt_day,
		            duty_cot,
		            modi_seq,
		            modi_cot1,
		            send_divi,
		            dpt_day,
		            rece
		        FROM cusdmr5asa1
		    ) A
		    LEFT OUTER JOIN (
		        SELECT 
		            exp_sdno,
		            rpt_no,
		            rpt_cus,
		            SUBSTRING_INDEX(USER_MEMO, '\n', 1) AS plant, 
		            CASE WHEN STR_CNT(USER_MEMO, '\n') >= 1 THEN SUBSTRING_INDEX(SUBSTRING_INDEX(USER_MEMO, '\n', 2), '\n', -1) ELSE '' END AS so
		        FROM cusdec830a1
		        WHERE RPT_SEQ = '00'
		    ) B ON A.exp_rpt_no = B.rpt_no
		    LEFT OUTER JOIN (
		        SELECT  
		            Rpt_No, 
		            BRANCH, 
		            CUS_PRG, 
		            GROUP_CONCAT(mg_code SEPARATOR ', ') AS invoice
		        FROM cusdec830b1
		        GROUP BY rpt_no
		    ) C ON A.exp_rpt_no = C.Rpt_No AND A.branch = C.BRANCH AND A.cus_prg = C.CUS_PRG
		    LEFT OUTER JOIN (
		        SELECT code, Cont
		        FROM cdstd
		        WHERE divi = '수출정정귀책사유'
		    ) D ON A.send_divi = D.code
		    LEFT OUTER JOIN (
		        SELECT code, Cont 
		        FROM cdstd 
		        WHERE divi = '세관및출장소'
		    ) E on B.Rpt_Cus = E.code
		    WHERE 1 = 1
		    <choose>
		        <when test="srch1 == '02'">
		            AND rece = '승인'
		        </when>
		        <when test="srch1 == '03'">
		            AND rece NOT IN ('승인')
		        </when>
		    </choose>
		    <choose>
		        <when test="srch8 == '01'">
		            AND rpt_day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		        </when>
		        <otherwise>
		            AND lis_day BETWEEN REPLACE(#{srch2}, '-','') AND REPLACE(#{srch3}, '-','')
		        </otherwise>
		    </choose>
		    <if test="srch4 != null and srch4 != ''">
		        AND b.rpt_no LIKE CONCAT('%',UPPER(REPLACE(#{srch4},'-','')),'%')
		    </if>
		    <if test="srch5 != null and srch5 != ''">
		        AND c.mg_code LIKE CONCAT('%',UPPER(#{srch5}),'%')
		    </if>
		    <if test="list != null and list.size() > 0">
		    	AND B.Exp_Sdno IN 
		        <foreach item="id" collection="list" open="(" separator="," close=")">
		            #{id}
		        </foreach>
		    </if>
		    ) A
		    WHERE 1=1
		    <if test="srchType1 != null and srchType1 != '' and srchText1 != null and srchText1 != ''">
		        AND ${srchType1} LIKE CONCAT('%',UPPER(#{srchText1}),'%')
		    </if>
		    <if test="srchType2 != null and srchType2 != '' and srchText2 != null and srchText2 != ''">
		        AND ${srchType2} LIKE CONCAT('%',UPPER(#{srchText2}),'%')
		    </if>
			GROUP BY expRptNo
			ORDER BY rptDay DESC;
	</select>
	
	<select id="selectExpDtlUpdViewList" parameterType="searchVO" resultType="egovMap">
		SELECT 
			rpt_no,
			ran_no,
			size_no,
			item_nm,
			modiFront1,
			modiAfter1,
			pre_no,
			seq_no,
			cont_seqno
		FROM cusdmr5asb1 b
		WHERE sna1 = #{srch1} AND rpt_no = #{srch2}
	</select>
	
	<delete id="deleteExpInFile" parameterType="searchVO">
		DELETE FROM FILE_INFO
		WHERE 1=1
		AND FILE_TYPE = 'exp'
		AND DOCU_FILE = #{srch1}
		AND DOCU_ORG_FILE = #{srch2}
		AND DOCU_PATH = #{srch3}
		AND UPLOAD_DT = REPLACE(#{srch4},'-','');
	</delete>
	
	<insert id="saveExpUserMemo" parameterType="searchVO">
		INSERT INTO MEMO_INFO
		(
			MEMO_TYPE,
			RPT_NO,
			USER_MEMO,
			DEL_YN,
			REG_DT	
		) VALUES (
			'exp',
			REPLACE(#{srch1},'-',''),
			#{srch2},
			'N',
			DATE_FORMAT(NOW(), '%Y%m%d')
		) ON DUPLICATE KEY
		UPDATE USER_MEMO = #{srch2}, EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d')
	</insert>
	
	<update id="expRequestBl" parameterType="searchVO">
		UPDATE file_info
		SET REQUEST_YN = 'Y'
		WHERE 1=1
		AND INVOICE_NO = #{srch1}
	</update>
	
	<select id="selectLoadDataList" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM export_main
		WHERE corp_no = #{srch1};
	</select>
	
	<select id="selectLoadDataMainView" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM export_main
		WHERE invoice_no = #{invoiceNo};
	</select>
	
	<select id="selectLoadDataSubView" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM export_item
		WHERE main_seq = 
		(SELECT main_seq FROM export_main WHERE invoice_no = #{invoiceNo});
	</select>
	
	<delete id="deleteLoadDataMainView" parameterType="searchVO">
		DELETE FROM export_main
		WHERE invoice_no = #{srch1};
	</delete>
	
	<delete id="deleteLoadDataSubView" parameterType="searchVO">
		DELETE FROM export_item
		WHERE main_seq = (SELECT main_seq FROM export_main_temp WHERE invoice_no = #{srch1});
	</delete>
	
	<select id="selectExportItemCntList" parameterType="searchVO" resultType="int">
		SELECT 
			COUNT(*)
		 	from export_item
		 	WHERE main_seq = (SELECT main_seq FROM export_main WHERE invoice_no = #{invoiceNo})
	</select>
	
	<select id="selectExportItemCntList2" parameterType="searchVO" resultType="int">
		SELECT 
			COUNT(*)
		 	from invoice_sub
		 	WHERE main_seq = (SELECT main_seq FROM invoice_info WHERE main_cd = #{ciNo})
	</select>
	
	<!-- ///////////////////////////////////////////////////////////////////// -->
	<select id="checkInvoiceNumber2" parameterType="searchVO" resultType="String">
		SELECT MAIN_CD
		FROM invoice_info
		WHERE MAIN_CD = #{srch1}
	</select>
	
	<select id="selectInvoiceMainIdex2" parameterType="egovframework.pf.exp.service.SaveExpInvoiceVO" resultType="String">
		SELECT MAIN_SEQ
		FROM invoice_info
		WHERE MAIN_CD = #{ciNo}
	</select>
	
	<insert id="saveInvoiceInfoList2" parameterType="egovframework.pf.exp.service.SaveExpInvoiceVO">
		INSERT INTO invoice_info(
			MAIN_CD,
			STS_CD,
		    CORP_NO,
		    IMPORTER,
		    CI_NO,
		    CONSIGNEE,
		    INVOICE_DATE,
		    EXPORTER,
		    OTHER_REFERENCES,
		    LC_NO,
		    LC_DATE,
		    ORIGIN,
		    TRANSPORT,
		    INCOTERMS,
		    LOADING_PORT,
		    LOCATION,
		    VESSEL,
		    VOYAGE_NO,
		    CONDITIONS,
		    DISCHARGE,
		    DELIVERY,
		    TRANSHIPMENT,
		    FREIGHT_METHOD,
		    FINAL_DESTINATION,
		    DEPARTURE_DATE,
		    GROSS_WEIGHT,
		    NET_WEIGHT,
		    CURRENCY,
		    TOTAL_AMOUNT,
		    FREIGH, 
		    INSURANCE,
		    PACKAGE_CODE,
		    PACKAGE_NAME,
		    TOTAL_PACKAGES,
		    COMMENTS,
		    DEL_YN,
		    REG_DT,
		    REG_ID
		) VALUES (
			#{mainCd},
			#{stsCd},
		    #{corpNo},
		    #{importer},
		    #{ciNo},
		    #{consignee},
		    #{invoiceDate},
		    #{exporter},
		    #{otherReferences},
		    #{lcNo},
		    #{lcDate},
		    #{origin},
		    #{transport},
		    #{incoterms},
		    #{loadingPort},
		    #{location},
		    #{vessel},
		    #{voyageNo},
		    #{conditions},
		    #{discharge},
		    #{delivery},
		    #{transhipment},
		    #{freightMethod},
		    #{finalDestination},
		    #{departureDate},
		    #{grossWeight},
		    #{netWeight},
		    #{currency},
		    #{totalAmount},
		    #{freigh}, 
		    #{insurance},
		    #{packageCode},
		    #{packageName},
		    #{totalPackages},
		    #{comments},
		    'N',
		    DATE_FORMAT(NOW(), '%Y%m%d'),
		    #{regId}
		) ON DUPLICATE KEY UPDATE
		    EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d'),
		    EDT_ID = #{edtId},
		    IMPORTER = #{importer},
		    CI_NO = #{ciNo},
		    CONSIGNEE = #{consignee},
		    INVOICE_DATE = #{invoiceDate},
		    EXPORTER = #{exporter},
		    OTHER_REFERENCES = #{otherReferences},
		    LC_NO = #{lcNo},
		    LC_DATE = #{lcDate},
		    ORIGIN = #{origin},
		    TRANSPORT = #{transport},
		    INCOTERMS = #{incoterms},
		    LOADING_PORT = #{loadingPort},
		    LOCATION = #{location},
		    VESSEL = #{vessel},
		    VOYAGE_NO = #{voyageNo},
		    CONDITIONS = #{conditions},
		    DISCHARGE = #{discharge},
		    DELIVERY = #{delivery},
		    TRANSHIPMENT = #{transhipment},
		    FREIGHT_METHOD = #{freightMethod},
		    FINAL_DESTINATION = #{finalDestination},
		    DEPARTURE_DATE = #{departureDate},
		    GROSS_WEIGHT = #{grossWeight},
		    NET_WEIGHT = #{netWeight},
		    CURRENCY = #{currency},
		    TOTAL_AMOUNT = #{totalAmount},
		    FREIGH = #{freigh}, 
		    INSURANCE = #{insurance},
		    PACKAGE_CODE = #{packageCode},
		    PACKAGE_NAME = #{packageName},
		    TOTAL_PACKAGES = #{totalPackages},
		    COMMENTS = #{comments},
		    DEL_YN = 'N';
	</insert>
	
	<insert id="saveInvoiceSubList2" parameterType="egovframework.pf.exp.service.SaveExpInvoiceVO">
		INSERT INTO invoice_sub (
			 MAIN_SEQ,
			 LINE_NO,
			 ITEM_CODE,
			 HS_CODE,
			 SPECIFICATION,
			 PACKING_NO,
			 QUANTITY,
			 UNIT_OF_QTY,
			 UNIT_PRICE,
			 AMOUNT_OF_PRICE,
			 DEL_YN,
			 REG_DT,
			 REG_ID
		)VALUES(
			 #{mainIndex},
			 #{lineNo},
			 #{itemCode},
			 #{hsCode},
			 #{specification},
			 #{packingNo},
			 #{quantity},
			 #{unitOfQty},
			 #{unitPrice},
			 #{amountOfPrice},
			 'N',
			 DATE_FORMAT(NOW(), '%Y%m%d'),
	  		 #{regId}
	  	) ON DUPLICATE KEY
			 UPDATE EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d')
			 , EDT_ID = #{edtId}
			 , LINE_NO = #{lineNo}
			 , ITEM_CODE = #{itemCode}
			 , HS_CODE = #{hsCode}
			 , SPECIFICATION = #{specification}
			 , PACKING_NO = #{packingNo}
			 , QUANTITY = #{quantity}
			 , UNIT_OF_QTY = #{unitOfQty}
		     , UNIT_PRICE = #{unitPrice}
		     , AMOUNT_OF_PRICE = #{amountOfPrice}
			 , DEL_YN = 'N'
	</insert>
	
	<select id="checkTempInvoiceNumber2" parameterType="searchVO" resultType="String">
		SELECT MAIN_SEQ
		FROM invoice_info_temp
		WHERE ci_no = #{srch10}
	</select>
	
	<insert id="saveTempExpMakeInList2" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO invoice_info_temp(
		    CORP_NO,
		    CMPNY_CD,
		    IMPORTER,
		    CI_NO,
		    CONSIGNEE,
		    INVOICE_DATE,
		    EXPORTER,
		    OTHER_REFERENCES,
		    LC_NO,
		    LC_DATE,
		    ORIGIN,
		    TRANSPORT,
		    INCOTERMS,
		    LOADING_PORT,
		    LOCATION,
		    VESSEL,
		    VOYAGE_NO,
		    CONDITIONS,
		    DISCHARGE,
		    DELIVERY,
		    TRANSHIPMENT,
		    FREIGHT_METHOD,
		    FINAL_DESTINATION,
		    DEPARTURE_DATE,
		    GROSS_WEIGHT,
		    NET_WEIGHT,
		    CURRENCY,
		    TOTAL_AMOUNT,
		    FREIGH, 
		    INSURANCE,
		    PACKAGE_CODE,
		    PACKAGE_NAME,
		    TOTAL_PACKAGES,
		    COMMENTS,
		    DEL_YN,
		    REG_DT,
		    REG_ID
		) VALUES (
		    #{corpNo},
		    #{cmpnyCd},
		    #{importer},
		    #{ciNo},
		    #{consignee},
		    #{invoiceDate},
		    #{exporter},
		    #{otherReferences},
		    #{lcNo},
		    #{lcDate},
		    #{origin},
		    #{transport},
		    #{incoterms},
		    #{loadingPort},
		    #{location},
		    #{vessel},
		    #{voyageNo},
		    #{conditions},
		    #{discharge},
		    #{delivery},
		    #{transhipment},
		    #{freightMethod},
		    #{finalDestination},
		    #{departureDate},
		    #{grossWeight},
		    #{netWeight},
		    #{currency},
		    #{totalAmount},
		    #{freigh}, 
		    #{insurance},
		    #{packageCode},
		    #{packageName},
		    #{totalPackages},
		    #{comments},
		    'N',
		    DATE_FORMAT(NOW(), '%Y%m%d'),
		    #{regId}
		 )
	</insert>
	
	<select id="selectTempInvoiceMainIdex2" parameterType="egovframework.pf.exp.service.SaveExpMainVO" resultType="String">
		SELECT MAIN_SEQ
		FROM invoice_info_temp
		WHERE ci_no = #{ciNo}
	</select>
	
	<insert id="saveTempExpMakeInSubList2" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO invoice_sub_temp(
			 MAIN_SEQ,
			 ITEM_CODE,
			 LINE_NO,
			 HS_CODE,
			 SPECIFICATION,
			 PACKING_NO,
			 QUANTITY,
			 UNIT_OF_QTY,
			 UNIT_PRICE,
			 AMOUNT_OF_PRICE,
			 DEL_YN,
			 REG_DT,
			 REG_ID
		)VALUES(
			#{mainIndex},
			#{itemCode},
			#{lineNo},
			#{hsCode},
			#{specification},
			#{packingNo},
			#{quantity},
			#{unitOfQty},
			#{unitPrice},
			#{amountOfPrice},
			'N',
			DATE_FORMAT(NOW(), '%Y%m%d'),
	  		#{regId}
	  	) 
	</insert>
	
	<select id="selectLoadDataList2" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM invoice_info
		WHERE corp_no = #{srch1}
		AND STS_CD = '10';  
	</select>
	
	<select id="selectLoadDataMainView2" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM invoice_info
		WHERE main_cd = #{ciNo};
	</select>
	
	<select id="selectLoadDataSubView2" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM invoice_sub
		WHERE main_seq = 
		(SELECT main_seq FROM invoice_info WHERE main_cd = #{ciNo});
	</select>
	
	<delete id="deleteLoadDataSubView2" parameterType="searchVO">
		DELETE FROM invoice_sub
		WHERE main_seq = (SELECT main_seq FROM invoice_info_temp WHERE ci_no = #{srch1});
	</delete>
	
	<delete id="deleteLoadDataMainView2" parameterType="searchVO">
		DELETE FROM invoice_info
		WHERE main_cd = #{ciNo};
	</delete>
		
	<delete id="deleteTempExpMakeInList2" parameterType="searchVO">
		DELETE FROM invoice_info_temp
		WHERE main_seq = #{srch1};
	</delete>
	
	<delete id="deleteTempExpMakeInSubList2" parameterType="searchVO">
		DELETE FROM invoice_sub_temp
		WHERE main_seq = #{srch1};
	</delete>
	
	<select id="selectTempInvoiceMainList2" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM invoice_info_temp
		WHERE ci_no = #{srch1};
	</select>
		
	<select id="selectTempInvoiceSubList2" parameterType="searchVO" resultType="egovMap">
		SELECT * FROM invoice_sub_temp
		WHERE main_seq = 
		(SELECT main_seq FROM invoice_info_temp WHERE ci_no = #{srch1});
	</select>
	
	<select id="selectExportMkInConditionList" parameterType="searchVO" resultType="egovMap">
		SELECT cmmn_cd, cmmn_nm
		FROM cmmn_cd
		WHERE grp_cd = 'CONDITIONS'
		<if test="srch1 != '' and srch1 != null">
		    AND cmmn_cd LIKE CONCAT('%', UPPER(#{srch1}), '%')
		</if>
	</select>
	
	<select id="selectCoRequset" parameterType="searchVO" resultType="egovMap">
		SELECT A.comm_firm AS compnyName,A.exp_sdno AS corpNo
		FROM cusdec830a1 A
		LEFT JOIN cusdec830B1 B
		ON A.RPT_NO = B.RPT_NO 
		AND A.BRANCH = B.BRANCH
		AND A.CUS_PRG = B.CUS_PRG
		WHERE A.RPT_NO =  REPLACE(#{srch2},'-','')
		AND B.MG_CODE = #{srch1}
	</select>
	
	<select id="selectCoStorage" parameterType="searchVO" resultType="egovMap">
	 SELECT CORP_NO AS corpNo,
	 		CMPNY_NM AS compnyName,
	 		BILLCMPNY_NM,
	 		FILE_NM,
	 		FILE_ORG_NM,
	 		BILLCORP_NO,
	 		MANAGER_NM,
	 		BILLMANAGER_NM,
	 		MANAGER_EMAIL,
	 		BILLMANAGER_EMAIL,
	 		MANAGER_NUM
		FROM CO_REQUEST
		WHERE RPT_NO = REPLACE(#{srch2},'-','')
		AND INVOICE_NO = #{srch1}
	</select>
	
	<insert id="saveCoTempData" parameterType="egovframework.pf.exp.service.SaveExpMainVO"> 
		INSERT INTO CO_REQUEST
			(   RPT_NO,
				INVOICE_NO,
				STATE,
				CORP_NO,
				BILLCORP_NO,
				CMPNY_NM,
				BILLCMPNY_NM,
				MANAGER_NM,
				BILLMANAGER_NM,
				MANAGER_EMAIL,
				BILLMANAGER_EMAIL,
				MANAGER_NUM,
				REG_DT,
				REG_ID
			)VALUES(
				REPLACE(#{rptNo},'-',''),
				#{invoiceNo},
				'1',
				#{corpNo},
				#{billCorpNo},
				#{cmpnyNm},
				#{billCmpnyNm},
				#{mangerNm},
				#{billManagerNm},
				#{managerEmail},
				#{billManagerEmail},
				#{managerNum},
				NOW(),
				#{regId}
				)
	</insert>
	
	<update id="updateCoTempData" parameterType="egovframework.pf.exp.service.SaveExpMainVO">   
	 UPDATE CO_REQUEST SET
		  BILLCORP_NO =  #{billCorpNo},
		  CMPNY_NM = #{cmpnyNm},
		  BILLCMPNY_NM = #{billCmpnyNm},
		  MANAGER_NM = #{mangerNm},
	      BILLMANAGER_NM = #{billManagerNm},
		  MANAGER_EMAIL = #{managerEmail},
	      BILLMANAGER_EMAIL = #{billManagerEmail},
		  MANAGER_NUM = #{managerNum},
		  EDT_ID = #{regId},
	  	  EDT_DT = NOW()
	  WHERE 
	   	RPT_NO = REPLACE(#{rptNo},'-','')
		AND	INVOICE_NO = #{invoiceNo}
		AND	STATE = #{state}
		AND CORP_NO =  #{corpNo}
	</update>
	
	<insert id="saveCoData" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
	INSERT INTO CO_REQUEST
			(   RPT_NO,
				INVOICE_NO,
				BILLCORP_NO,
				STATE,
				CORP_NO,
				CMPNY_NM,
				BILLCMPNY_NM,
				MANAGER_NM,
				BILLMANAGER_NM,
				MANAGER_EMAIL,
				BILLMANAGER_EMAIL,
				MANAGER_NUM,
				FILE_NM,
				FILE_ORG_NM,
				REG_DT,
				REG_ID
			)VALUES(
				REPLACE(#{rptNo},'-',''),
				#{invoiceNo},
				#{billCorpNo},
				'2',
				#{corpNo},
				#{cmpnyNm},
				#{billCmpnyNm},
				#{mangerNm},
				#{billManagerNm},
				#{managerEmail},
				#{billManagerEmail},
				#{managerNum},
				#{fileNm},
				#{fileOrgNm},
				NOW(),
				#{regId}
				)
	</insert>
	
	<update id="updateCoData" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		 UPDATE CO_REQUEST SET
		  BILLCORP_NO =  #{billCorpNo},
		  STATE = '2',
		  CMPNY_NM = #{cmpnyNm},
		  BILLCMPNY_NM = #{billCmpnyNm},
		  MANAGER_NM = #{mangerNm},
	      BILLMANAGER_NM = #{billManagerNm},
		  MANAGER_EMAIL = #{managerEmail},
	      BILLMANAGER_EMAIL = #{billManagerEmail},
		  MANAGER_NUM = #{managerNum},
		  FILE_NM = #{fileNm},
		  FILE_ORG_NM = #{fileOrgNm},
		  EDT_ID = #{regId},
	  	  EDT_DT = NOW()
	  WHERE 
	   	RPT_NO = REPLACE(#{rptNo},'-','')
		AND	INVOICE_NO = #{invoiceNo}
		AND CORP_NO =  #{corpNo}
	</update>
	
	<select id="selectmanagerEmail" parameterType="egovframework.pf.exp.service.SaveExpMainVO" resultType="String">
		SELECT CHR_EMAIL5
		FROM cmpny_charge_info
		WHERE TAX_NO =  #{corpNo}
	</select>
	
	<select id="selectCoFilesList" parameterType="egovframework.pf.exp.service.SaveExpMainVO" resultType="egovMap">
		SELECT
		   RPT_NO,
		   INVOICE_NO,
		   FILE_NM,
		   FILE_ORG_NM,
		   REG_DT,
		   EDT_DT
		FROM
		   co_request
		WHERE
		   rpt_no = REPLACE(#{rptNo},'-','')
		 AND CORP_NO = #{corpNo}
		 AND INVOICE_NO = #{invoiceNo}
		 AND STATE = '2'
	</select>
	
	<insert id="insertCoInfo" parameterType="egovframework.pf.exp.service.SaveExpMainVO">
		INSERT INTO CO_INFO 
		(
		TAX_NO,
		RPT_NO,
		INVOICE_NO,
		CO_DATE,
		CO_NAME
		)VALUES(
		#{corpNo},
		REPLACE(#{rptNo},'-',''),
		#{invoiceNo},
		DATE_FORMAT(NOW(), '%Y%m%d%H%i%s'),
		#{regId}
		)
	</insert>
	
	<select id="selectCoList" parameterType="searchVO" resultType="egovMap">
		SELECT 
			A.CO_DATE,
			DATE_FORMAT(STR_TO_DATE(A.co_date, '%Y%m%d%H%i%s'), '%Y/%m/%d') AS formatDate,
			A.CO_NAME,
			A.STATE,
			A.SUB_NUM,
			A.INVOICE_NO,
			CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', SUBSTRING(a.rpt_no, 6, 2), '-', SUBSTRING(a.rpt_no, 8, 7)) AS rpt_no,
			DATE_FORMAT(STR_TO_DATE(A.LIS_DAY, '%Y%m%d'), '%Y/%m/%d') AS lisDay,
			A.PRODUCER,
			A.IMPORT_COUNTRY,
			A.IMPORTER,
			A.IMPGNAME,
			A.QTY,
			A.UT,
			A.AMT,
			A.CONCOD,
			CONCAT(SUBSTRING(A.HSCODE, 1, 4), '.', 
            SUBSTRING(A.HSCODE, 5, 2), '-', 
            SUBSTRING(A.HSCODE, 7, 4)) AS hsCode,
			A.DETER_ORIGIN,
			A.FREE_NAME,
			A.ISSUE_NO,
			'' as ex,
			DATE_FORMAT(STR_TO_DATE(A.ISSUE_DATE, '%Y%m%d'), '%Y/%m/%d') AS issueDate,
			CASE WHEN
			    <!-- COALESCE(b.docu_file, '') &lt;&gt;  ''
			    OR  -->
			    b.docu_type = 'COFILE'
			THEN 'O'
			ELSE '-'
			END AS coFile,
			CASE WHEN
			   <!--  COALESCE(b.docu_file, '') &lt;&gt; ''
			    OR  -->
			    b.docu_type = 'SUMMITFILE'
			THEN 'O'
			ELSE '-'
			END AS summitFile,
			A.ISSUANCE_COST,
			A.JUDGMENT_COST
		FROM CO_INFO A
		LEFT JOIN file_info B
		ON A.CO_DATE = B.REG_DT
		AND A.CO_NAME = B.REG_ID
		WHERE 1=1 
		<if test="list != null and list.size() > 0">
            AND A.TAX_NO IN 
            <foreach item="id" collection="list" open="(" separator="," close=")">
                #{id}
            </foreach>
     	</if>
     	<if test="list2 != null and list2.size() > 0">
	    AND A.RPT_NO IN 
	    <foreach item="rptno" collection="list2" open="(" separator="," close=")">
	        #{rptno}
	    </foreach>
	    </if>
		<if test="srch1 == '03'">
			 AND A.STATE LIKE CONCAT('%', '의뢰', '%')
		</if>
		<if test="srch1 == '04'">
			 AND A.STATE LIKE CONCAT('%', '판정', '%')
		</if>
		<if test="srch1 == '05'">
			 AND A.STATE LIKE CONCAT('%', '접수', '%')
		</if>
		<if test="srch1 == '06'">
			 AND A.STATE LIKE CONCAT('%', '승인', '%')
		</if>
		<if test="srch1 == '07'">
			 AND A.STATE LIKE CONCAT('%', '발송', '%')
		</if>
		<if test="srch1 == '08'">
			 AND A.STATE LIKE CONCAT('%', '정정', '%')
		</if>
		<if test="srch2 != null and srch2 != ''">
			AND A.INVOICE_NO LIKE CONCAT('%',UPPER(#{srch2}),'%')
		</if>
		<if test="srch3 != null and srch3 != ''">
			AND REPLACE(A.RPT_NO, '-', '') LIKE CONCAT('%', REPLACE(UPPER(#{srch3}), '-', ''), '%')
		</if>
		<choose>
		    <when test="srch7 == '01'">
		        AND  DATE(A.CO_DATE) BETWEEN REPLACE(#{srch4}, '-','') AND REPLACE(#{srch5}, '-','')
		    </when>
		    <otherwise>
		       AND A.ISSUE_DATE BETWEEN REPLACE(#{srch4}, '-','') AND REPLACE(#{srch5}, '-','')
		    </otherwise>
		</choose>
		GROUP BY A.CO_DATE
		ORDER BY A.SUB_NUM,A.CO_DATE desc
		LIMIT #{recordCountPerPage} OFFSET #{startPage};
	</select>
	
	<insert id="insertCoFilesInfo"  parameterType="egovframework.pf.docu.service.SaveDocuFileVO">
	INSERT INTO file_info
		(	FILE_TYPE
		  ,	RPT_NO
		  , INVOICE_NO
		  , UPLOAD_DT
		  , DOCU_TYPE
		  , DOCU_PATH
		  , DOCU_FILE
		  , DOCU_ORG_FILE
		  , CMPNY_CD
		  , DEL_YN
		  , REG_DT
		  , REG_ID
		) VALUES (
		    #{fileType}
		  ,	replace(#{rptNo},'-','')
		  , #{invoiceNo}
		  , #{uploadDt}
		  , #{docuType}
		  , '/home/files'
		  , #{fileName}
		  , #{orgFileName}
		  , #{cmpnyCd}
		  , 'N'
		  , #{regDt}
		  , #{regId}
		);
	</insert>
	<select id="selectCoFileModalUpdateList" parameterType="searchVO" resultType="egovMap">
		SELECT 
			RPT_NO,
			'1' as guide,
			DATE_FORMAT(upload_dt, '%Y-%m-%d') AS upload_dt,
			docu_file,
			docu_org_file
			FROM file_info
			WHERE FILE_TYPE = 'CO' 
			AND DOCU_TYPE = 'COFILE'
			AND REG_DT = #{srch5}
			AND REG_ID = #{srch6}
	</select>
	
		<select id="selectSummitFileModalUpdateList" parameterType="searchVO" resultType="egovMap">
		SELECT 
			RPT_NO,
			'1' as guide,
			DATE_FORMAT(upload_dt, '%Y-%m-%d') AS upload_dt,
			docu_file,
			docu_org_file
			FROM file_info
			WHERE FILE_TYPE = 'CO' 
			AND DOCU_TYPE = 'SUMMITFILE'
			AND REG_DT = #{srch5}
			AND REG_ID = #{srch6}
	</select>
	
	<delete id="deleteCoDocuFile" parameterType="searchVO">
		DELETE FROM FILE_INFO
		WHERE 1=1
		AND DOCU_FILE = #{srch1}
		AND DOCU_ORG_FILE = #{srch2}
		AND UPLOAD_DT = REPLACE(#{srch3},'-','')
		AND CMPNY_CD = #{srch4}
		AND FILE_TYPE = 'CO'
		AND DOCU_TYPE = #{srch5}
	</delete>
	
	<update id = "saveCoInfo" parameterType="egovframework.pf.exp.service.SaveExportCoVO">
		UPDATE CO_INFO SET 
			 STATE = #{state}
			,SUB_NUM = #{subNum}
			,INVOICE_NO = #{invoiceNo}
			,RPT_NO = REPLACE(REPLACE(#{rptNo}, '-', ''), '/', '')
			,LIS_DAY = REPLACE(REPLACE(#{lisDay}, '-', ''), '/', '')
			,PRODUCER = #{producer}
			,IMPORT_COUNTRY = #{importCountry}
			,IMPORTER = #{importer}
			,IMPGNAME = #{impgname}
			,QTY = #{qty}
			,UT = #{ut}
			,AMT = #{amt}
			,CONCOD = #{concod}
			,HSCODE = #{hscode}
			,DETER_ORIGIN = #{deterOrigin}
			,FREE_NAME = #{freeName}
			,ISSUE_NO = #{issueNo}
			,ISSUE_DATE = REPLACE(REPLACE(#{issueDate}, '-', ''), '/', '')
			,ISSUANCE_COST = REPLACE(#{issuanceCost},',','')
			,JUDGMENT_COST = REPLACE(#{judgmentCost},',','')
			,DEL_YN = 'N'
			,REG_DT = DATE_FORMAT(NOW(), '%Y%m%d')
			,REG_ID = #{regId}
		WHERE 
		      CO_DATE = #{coDate} 
		  AND CO_NAME = #{coName}
	</update>
	
	<select id="selectBlno" parameterType="searchVO" resultType="string">
	
	SELECT invoice
	FROM (
	SELECT mg_code AS invoice
	FROM cusdec830b1selrdy
	WHERE rpt_no = REPLACE(#{srch2},'-','') AND rpt_seq = '00' UNION
	SELECT mg_code AS invoice
	FROM cusdec830b1airrdy
	WHERE rpt_no = REPLACE(#{srch2},'-','') AND rpt_seq = '00' UNION
	SELECT  mg_code AS invoice
	FROM cusdec830b1icnrdy
	WHERE rpt_no = REPLACE(#{srch2},'-','') AND rpt_seq = '00' UNION
	SELECT mg_code AS invoice
	FROM cusdec830b1bsnrdy
	WHERE rpt_no = REPLACE(#{srch2},'-','') AND rpt_seq = '00' UNION
	SELECT TE2_005 AS invoice
	FROM temp_export2bsnenc
	WHERE TE2_001 = REPLACE(#{srch2},'-','')) A
    LIMIT 1
   ;	 
	</select>
	
	<select id="selectExpTodayViewList" parameterType="searchVO" resultType="egovMap">
		SELECT 
		    '진행현황' AS expRece,
	    	SUM(reqCnt) AS reqCnt,
	    	SUM(ingCnt) AS ingCnt,
	    	SUM(failCnt) AS failCnt,
	    	SUM(cmpCnt) AS cmpCnt,
	    	SUM(loadCmpCnt) AS loadCmpCnt
		FROM (
			SELECT  
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
			    (SELECT COUNT(*) FROM cusdec830a1selrdy b WHERE b.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.rpt_seq = '00') AS loadCmpCnt
			FROM cusdec830a1selrdy a
			WHERE a.rpt_seq = '00'
			AND a.rpt_Day BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
	    	UNION
	
	    	SELECT 
	    		COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
			    (SELECT COUNT(*) FROM cusdec830a1icnrdy b WHERE b.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.rpt_seq = '00') AS loadCmpCnt
	    	FROM cusdec830a1icnrdy a
	    	WHERE a.rpt_seq = '00' 
	      	AND a.rpt_Day BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
	    	UNION
	
	    	SELECT 
	       		COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
			    (SELECT COUNT(*) FROM cusdec830a1airrdy b WHERE b.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.rpt_seq = '00') AS loadCmpCnt
	    	FROM cusdec830a1airrdy a
	    	WHERE a.rpt_seq = '00'
	      	AND a.rpt_Day BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
	    	UNION
	
			SELECT 
	    		COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
			    (SELECT COUNT(*) FROM cusdec830a1bsnrdy b WHERE b.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.rpt_seq = '00') AS loadCmpCnt
			FROM cusdec830a1bsnrdy a
			WHERE a.rpt_seq = '00' 
	  		AND a.rpt_Day BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
	   		UNION
	
	    	SELECT 
	    	
	    	COUNT(CASE WHEN CONVERT(a.TE1_098 USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
		    COUNT(CASE WHEN CONVERT(a.TE1_098 USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
		    COUNT(CASE WHEN CONVERT(a.TE1_098 USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
		    COUNT(CASE WHEN CONVERT(a.TE1_098 USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
		    (SELECT COUNT(*) FROM temp_export1bsnenc b WHERE b.TE1_142 = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.TE1_032 = '00') AS loadCmpCnt
	    	FROM temp_export1bsnenc a
	   		WHERE a.TE1_034 BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
		 	<if test="list != null and list.size() > 0">
	            AND a.TE1_126 IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
		) AS EXPORT
	</select>
	
	<select id="selectExpTodayInclOthViewList" parameterType="searchVO" resultType="egovMap">
		SELECT 
		    '진행현황' AS expRece,
	    	SUM(a.reqCnt) + b.reqCnt AS reqCnt,
	    	SUM(a.ingCnt) + b.ingCnt AS ingCnt,
	    	SUM(a.failCnt) + b.failCnt AS failCnt,
	    	SUM(a.cmpCnt) + b.cmpCnt AS cmpCnt,
	    	SUM(a.loadCmpCnt) + b.loadCmpCnt AS loadCmpCnt
		FROM (
			SELECT  
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
			    (SELECT COUNT(*) FROM cusdec830a1selrdy b WHERE b.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.rpt_seq = '00') AS loadCmpCnt
			FROM cusdec830a1selrdy a
			WHERE a.rpt_seq = '00'
			AND a.rpt_Day BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
	    	UNION
	
	    	SELECT 
	    		COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
			    (SELECT COUNT(*) FROM cusdec830a1icnrdy b WHERE b.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.rpt_seq = '00') AS loadCmpCnt
	    	FROM cusdec830a1icnrdy a
	    	WHERE a.rpt_seq = '00' 
	      	AND a.rpt_Day BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
	    	UNION
	
	    	SELECT 
	       		COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
			    (SELECT COUNT(*) FROM cusdec830a1airrdy b WHERE b.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.rpt_seq = '00') AS loadCmpCnt
	    	FROM cusdec830a1airrdy a
	    	WHERE a.rpt_seq = '00'
	      	AND a.rpt_Day BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
	    	UNION
	
			SELECT 
	    		COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
			    (SELECT COUNT(*) FROM cusdec830a1bsnrdy b WHERE b.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.rpt_seq = '00') AS loadCmpCnt
			FROM cusdec830a1bsnrdy a
			WHERE a.rpt_seq = '00' 
	  		AND a.rpt_Day BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
			<if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
	   		UNION
	
	    	SELECT 
	    	
	    	COUNT(CASE WHEN CONVERT(a.TE1_098 USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
		    COUNT(CASE WHEN CONVERT(a.TE1_098 USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
		    COUNT(CASE WHEN CONVERT(a.TE1_098 USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
		    COUNT(CASE WHEN CONVERT(a.TE1_098 USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
		    (SELECT COUNT(*) FROM temp_export1bsnenc b WHERE b.TE1_142 = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.TE1_032 = '00') AS loadCmpCnt
	    	FROM temp_export1bsnenc a
	   		WHERE a.TE1_034 BETWEEN REPLACE(CURDATE(), '-', '') AND REPLACE(CURDATE(), '-', '')
		 	<if test="list != null and list.size() > 0">
	            AND a.TE1_126 IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
		) AS a
		JOIN 
		    (
		     SELECT 
		     	COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('의뢰', '') THEN 1 ELSE NULL END) AS reqCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) IN ('접수', '검사', '제출', '전제') THEN 1 ELSE NULL END) AS ingCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '미결' THEN 1 ELSE NULL END) AS failCnt,
			    COUNT(CASE WHEN CONVERT(a.rece USING utf8mb4) = '완료' THEN 1 ELSE NULL END) AS cmpCnt,
			    (SELECT COUNT(*) FROM cusdec830a1 b WHERE b.ship_day = DATE_FORMAT(CURDATE(), '%Y%m%d') AND b.rpt_seq = '00') AS loadCmpCnt
		     FROM cusdec830a1 a
		     WHERE a.branch = 'ioom' 
		     AND a.rpt_day = REPLACE(CURDATE(), '-', '')
		     <if test="list != null and list.size() > 0">
	            AND a.exp_sdno IN
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
        	</if>
		    ) b;
	</select>
	
	<select id="selectExpDetailView" parameterType="searchVO" resultType="egovMap">
	    SELECT 
			CASE WHEN a.rpt_no != '' THEN CONCAT_WS('-', SUBSTRING(a.rpt_no, 1, 5), SUBSTRING(a.rpt_no, 6, 2), SUBSTRING(a.rpt_no, 8)) ELSE '' END AS rpt_no, 
			CASE WHEN rpt_day != '' THEN DATE_FORMAT(rpt_day, '%Y-%m-%d') ELSE '' END AS rpt_day,
			CASE WHEN exp_lis_day != '' THEN DATE_FORMAT(exp_lis_day, '%Y-%m-%d') ELSE '' END AS exp_lis_day,
			a.exp_firm,
			a.mak_firm, 
			a.buy_Firm,
			b.mg_Code, 
			a.amt_cod,
			a.cur,
			FORMAT(a.amt, 2) AS amt,
			a.fre_Krw,
			a.insu_Krw,
			a.tot_pack_cnt,
			a.tot_pack_ut,
			FORMAT(a.tot_wt, 2) AS tot_wt,
			a.ut,
			a.exc_divi,
			a.con_met,
			CASE WHEN juk_day != '' THEN DATE_FORMAT(a.juk_day, '%Y-%m-%d') ELSE '' END AS juk_day,
			b.ran_no, 
			b.hs,
			b.std_gnm,
			FORMAT(b.Rpt_Krw, 2) AS Rpt_Krw,
			FORMAT(b.Rpt_Usd, 2) AS Rpt_Usd, 
			b.cur_ut,
			FORMAT(b.con_amt, 4) AS con_amt,
			FORMAT(b.Sun_Wt, 4) AS Sun_Wt,
			b.sun_ut,
			b.wt,
			b.ut,
			b.Imp_Rpt_Send,
			b.Imp_Ran_No,
			b.ori_st_mark1,
			c.sil, 
			c.mg_cd, 
			c.Gnm1,
			c.gnm2,
			FORMAT(c.qty, 4) AS qty,
			c.qty_ut,
			FORMAT(c.Price, 2) AS Price,
			FORMAT(c.amt, 4) AS amt
		FROM cusdec830a1 a
		LEFT JOIN cusdec830b1 b ON a.rpt_no = b.rpt_no
		LEFT JOIN cusdec830c1 c ON a.rpt_no = c.rpt_no
	    WHERE 1=1
	    <choose>
	        <when test="srch3 == '01'">
	            AND a.rpt_Day BETWEEN REPLACE(#{srch1}, '-', '') AND REPLACE(#{srch2}, '-', '')
	        </when>
	        <otherwise>
	            AND a.exp_lis_day BETWEEN REPLACE(#{srch1}, '-', '') AND REPLACE(#{srch2}, '-', '')
	        </otherwise>
	    </choose>
	    <if test="list != null and list.size() > 0">
	        AND a.exp_sdno IN 
	        <foreach item="id" collection="list" open="(" separator="," close=")">
	            #{id}
	        </foreach>
	    </if>
	</select>
	
	<insert id="insertExpExcelStatus" parameterType="searchVO">
		INSERT INTO excel_status (
			cmpny_cd,
			type, 
			total_cnt, 
			job_cnt, 
			reg_dt
		) VALUES (
			#{cmpnyCd},
			'exp', 
			#{sExcelBuffer}, 
			#{eExcelBuffer}, 
			NOW()
		) ON DUPLICATE KEY UPDATE
			type = 'exp',
		    total_cnt = #{sExcelBuffer},
		    job_cnt = #{eExcelBuffer}, 
		    reg_dt = NOW();
	</insert>
	
	<select id="selectExpDetailProgress" parameterType="searchVO" resultType="egovMap">
		SELECT job_cnt, total_cnt FROM excel_status WHERE cmpny_cd = #{srch1}
	</select>
</mapper>