<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.pf.item.service.impl.pfItemMapper">

	<!--중복허용X 전체아이템 조회 -->
	<select id="selectItemViewList" parameterType="searchVO" resultType="egovMap">
			SELECT 
			COUNT(*) OVER() as CNT,
			itemCode,
			saleNo,
			reporter,
			desCirp,
			firstLisDay,
			lastLisDay
			FROM(
			SELECT 
			 a.item_code AS itemCode,
			 b.EXC_GNAME AS saleNo, 
			 REPORTER AS reporter,
			 b.ITEM_DESC AS desCirp, 
			 DATE_FORMAT((a.first_lis_day), '%Y-%m-%d') AS firstLisDay,
 		     DATE_FORMAT((a.last_lis_day), '%Y-%m-%d') AS lastLisDay
			FROM
			(
				SELECT
					cmpny_cd,
					item_code,
					max(max_seq) max_seq,
					MIN(first_lis_day) first_lis_day,
					MAX(last_lis_day) last_lis_day
				FROM
					item_info
				WHERE 1=1
				<if test="list != null and list.size() > 0">
		            AND cmpny_cd IN 
		            <foreach item="id" collection="list" open="(" separator="," close=")">
		                #{id}
		            </foreach>
	        	</if>
				<choose>
			        <when test="srch10 == '01'">
			            AND last_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </when>
			        <otherwise>
			            AND first_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </otherwise>
			    </choose>
				GROUP BY
					cmpny_cd,
					item_code
			) a
			INNER JOIN (
				SELECT
				*
				FROM
				item_info
				WHERE 1=1
				<if test="list != null and list.size() > 0">
		            AND cmpny_cd IN 
		            <foreach item="id" collection="list" open="(" separator="," close=")">
		                #{id}
		            </foreach>
	        	</if>
				<choose>
			        <when test="srch10 == '01'">
			            AND last_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </when>
			        <otherwise>
			            AND first_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </otherwise>
			    </choose>
			) b ON a.cmpny_cd = b.CMPNY_CD
			AND a.item_code = b.item_code
			AND a.max_seq = b.MAX_SEQ
		    ) A WHERE 1=1
			<if test="srchType1 != null and srchType1 != '' and srchText1 != null and srchText1 != ''">
			AND ${srchType1} LIKE CONCAT('%',UPPER(#{srchText1}),'%')
			</if>
			<if test="srchType2 != null and srchType2 != '' and srchText2 != null and srchText2 != ''">
			AND ${srchType2} LIKE CONCAT('%',UPPER(#{srchText2}),'%')
			</if>
			<choose>
		        <when test="srch10 == '01'">
		          ORDER BY lastLisDay DESC, firstLisDay DESC, saleNo ASC, itemCode ASC
		        </when>
		        <otherwise>
		            ORDER BY firstLisDay DESC, lastLisDay DESC, saleNo ASC, itemCode ASC
		        </otherwise>
	        </choose>
			LIMIT #{recordCountPerPage} OFFSET #{startPage}; 
	</select>
	
	
	<!--중복허용X 수입아이템 조회 -->
	<select id="selectItemViewimportList" parameterType="searchVO" resultType="egovMap">
			SELECT 
			COUNT(*) OVER() as CNT,
			itemCode,
			saleNo,
			reporter,
			desCirp,
			firstLisDay,
			lastLisDay
			FROM(
			SELECT
			 a.item_code AS itemCode,
			 b.EXC_GNAME AS saleNo, 
			 REPORTER AS reporter,
			 b.ITEM_DESC AS desCirp, 
			 DATE_FORMAT((a.first_lis_day), '%Y-%m-%d') AS firstLisDay,
 		     DATE_FORMAT((a.last_lis_day), '%Y-%m-%d') AS lastLisDay
			FROM
			(
				SELECT
					cmpny_cd,
					item_code,
					max(max_seq) max_seq,
					MIN(first_lis_day) first_lis_day,
					MAX(last_lis_day) last_lis_day
				FROM
					item_info
				WHERE 1=1
				<!-- WHERE cmpny_cd = #{corpNo} -->
				<if test="list != null and list.size() > 0">
		            AND cmpny_cd IN 
		            <foreach item="id" collection="list" open="(" separator="," close=")">
		                #{id}
		            </foreach>
	        	</if>
				AND trade_type = 'imp'
				<choose>
			        <when test="srch10 == '01'">
			            AND last_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </when>
			        <otherwise>
			            AND first_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </otherwise>
			    </choose>
				GROUP BY
					cmpny_cd,
					item_code
			) a
			INNER JOIN (
				SELECT
				*
				FROM
				item_info
				WHERE 1=1
				<!-- WHERE cmpny_cd = #{corpNo} -->
				<if test="list != null and list.size() > 0">
		            AND cmpny_cd IN 
		            <foreach item="id" collection="list" open="(" separator="," close=")">
		                #{id}
		            </foreach>
	        	</if>
				AND trade_type = 'imp'
				<choose>
			        <when test="srch10 == '01'">
			            AND last_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </when>
			        <otherwise>
			            AND first_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </otherwise>
			    </choose>
			) b ON a.cmpny_cd = b.CMPNY_CD
			AND a.item_code = b.item_code
			AND a.max_seq = b.MAX_SEQ
			) A WHERE 1=1
			<if test="srchType1 != null and srchType1 != '' and srchText1 != null and srchText1 != ''">
			AND ${srchType1} LIKE CONCAT('%',UPPER(#{srchText1}),'%')
			</if>
			<if test="srchType2 != null and srchType2 != '' and srchText2 != null and srchText2 != ''">
			AND ${srchType2} LIKE CONCAT('%',UPPER(#{srchText2}),'%')
			</if>
			<choose>
		        <when test="srch10 == '01'">
		          ORDER BY lastLisDay DESC, firstLisDay DESC, saleNo ASC, itemCode ASC
		        </when>
		        <otherwise>
		            ORDER BY firstLisDay DESC, lastLisDay DESC, saleNo ASC, itemCode ASC
		        </otherwise>
		    </choose>
			LIMIT #{recordCountPerPage} OFFSET #{startPage}; 
	</select>
	
	<!--중복허용X 수출아이템 조회 -->
	<select id="selectItemViewExportList" parameterType="searchVO" resultType="egovMap">
			SELECT 
			COUNT(*) OVER() as CNT,
			itemCode,
			saleNo,
			reporter,
			desCirp,
			firstLisDay,
			lastLisDay
			FROM(
			SELECT 
			 a.item_code AS itemCode,
			 b.EXC_GNAME AS saleNo, 
			 REPORTER AS reporter,
			 b.ITEM_DESC AS desCirp, 
			 DATE_FORMAT((a.first_lis_day), '%Y-%m-%d') AS firstLisDay,
 		     DATE_FORMAT((a.last_lis_day), '%Y-%m-%d') AS lastLisDay
			FROM
			(
				SELECT
					cmpny_cd,
					item_code,
					max(max_seq) max_seq,
					MIN(first_lis_day) first_lis_day,
					MAX(last_lis_day) last_lis_day
				FROM
					item_info
				WHERE 1=1
				<!-- WHERE cmpny_cd = #{corpNo} -->
				<if test="list != null and list.size() > 0">
		            AND cmpny_cd IN 
		            <foreach item="id" collection="list" open="(" separator="," close=")">
		                #{id}
		            </foreach>
	        	</if>
				AND trade_type = 'exp'
				<choose>
			        <when test="srch10 == '01'">
			            AND last_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </when>
			        <otherwise>
			            AND first_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </otherwise>
			    </choose>
				GROUP BY
					cmpny_cd,
					item_code
			) a
			INNER JOIN (
				SELECT
				*
				FROM
				item_info
				WHERE 1=1
				<!-- WHERE cmpny_cd = #{corpNo} -->
				<if test="list != null and list.size() > 0">
		            AND cmpny_cd IN 
		            <foreach item="id" collection="list" open="(" separator="," close=")">
		                #{id}
		            </foreach>
	        	</if>
				AND trade_type = 'exp'
				<choose>
			        <when test="srch10 == '01'">
			            AND last_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </when>
			        <otherwise>
			            AND first_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </otherwise>
			    </choose>
			) b ON a.cmpny_cd = b.CMPNY_CD
			AND a.item_code = b.item_code
			AND a.max_seq = b.MAX_SEQ
			) A WHERE 1=1
			<if test="srchType1 != null and srchType1 != '' and srchText1 != null and srchText1 != ''">
			AND ${srchType1} LIKE CONCAT('%',UPPER(#{srchText1}),'%')
			</if>
			<if test="srchType2 != null and srchType2 != '' and srchText2 != null and srchText2 != ''">
			AND ${srchType2} LIKE CONCAT('%',UPPER(#{srchText2}),'%')
			</if>
			<choose>
		        <when test="srch10 == '01'">
		          ORDER BY lastLisDay DESC, firstLisDay DESC, saleNo ASC, itemCode ASC
		        </when>
		        <otherwise>
		            ORDER BY firstLisDay DESC, lastLisDay DESC, saleNo ASC, itemCode ASC
		        </otherwise>
		    </choose>
			LIMIT #{recordCountPerPage} OFFSET #{startPage}; 
	</select>
	
	<!-- Item목록 현황 (중복허용) 목록 조회 -->
	<select id="selectDuplicationItemViewList" parameterType="searchVO" resultType="egovMap">
	SELECT 
			COUNT(*) OVER() as CNT,
			itemCode,
			saleNo,
			reporter,
			desCirp,
			firstLisDay,
			lastLisDay
			FROM(
	SELECT 
	 item_code AS itemCode,
	 EXC_GNAME AS saleNo, 
	 REPORTER AS reporter,
	 ITEM_DESC AS desCirp, 
	 DATE_FORMAT((first_lis_day), '%Y-%m-%d') AS firstLisDay,
	 DATE_FORMAT((last_lis_day), '%Y-%m-%d') AS lastLisDay
	FROM 
	ITEM_INFO 
	WHERE 1=1
	<!-- WHERE cmpny_cd = #{corpNo} -->
	<if test="list != null and list.size() > 0">
           AND cmpny_cd IN 
           <foreach item="id" collection="list" open="(" separator="," close=")">
               #{id}
           </foreach>
  	</if>
				<choose>
			        <when test="srch10 == '01'">
			            AND last_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </when>
			        <otherwise>
			            AND first_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </otherwise>
			    </choose>
		    ) A WHERE 1=1
			<if test="srchType1 != null and srchType1 != '' and srchText1 != null and srchText1 != ''">
			AND ${srchType1} LIKE CONCAT('%',UPPER(#{srchText1}),'%')
			</if>
			<if test="srchType2 != null and srchType2 != '' and srchText2 != null and srchText2 != ''">
			AND ${srchType2} LIKE CONCAT('%',UPPER(#{srchText2}),'%')
			</if>
			<choose>
		        <when test="srch10 == '01'">
		          ORDER BY lastLisDay DESC, firstLisDay DESC, saleNo ASC, itemCode ASC
		        </when>
		        <otherwise>
		            ORDER BY firstLisDay DESC, lastLisDay DESC, saleNo ASC, itemCode ASC
		        </otherwise>
		    </choose>
			LIMIT #{recordCountPerPage} OFFSET #{startPage};
	</select>
	
	<select id = "selectDuplicationItemViewimportList" parameterType="searchVO" resultType="egovMap">
			SELECT 
			COUNT(*) OVER() as CNT,
			itemCode,
			saleNo,
			reporter,
			desCirp,
			firstLisDay,
			lastLisDay
			FROM(
			SELECT 
			 item_code AS itemCode,
			 EXC_GNAME AS saleNo, 
			 REPORTER AS reporter,
			 ITEM_DESC AS desCirp, 
			 DATE_FORMAT((first_lis_day), '%Y-%m-%d') AS firstLisDay,
			 DATE_FORMAT((last_lis_day), '%Y-%m-%d') AS lastLisDay
			FROM 
			ITEM_INFO 
			WHERE 1=1
	<!-- WHERE cmpny_cd = #{corpNo} -->
	<if test="list != null and list.size() > 0">
           AND cmpny_cd IN 
           <foreach item="id" collection="list" open="(" separator="," close=")">
               #{id}
           </foreach>
      	</if>
				AND trade_type = 'imp'
				<choose>
			        <when test="srch10 == '01'">
			            AND last_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </when>
			        <otherwise>
			            AND first_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </otherwise>
		    	</choose>
				 ) A WHERE 1=1
				<if test="srchType1 != null and srchType1 != '' and srchText1 != null and srchText1 != ''">
				AND ${srchType1} LIKE CONCAT('%',UPPER(#{srchText1}),'%')
				</if>
				<if test="srchType2 != null and srchType2 != '' and srchText2 != null and srchText2 != ''">
				AND ${srchType2} LIKE CONCAT('%',UPPER(#{srchText2}),'%')
				</if>
				<choose>
			        <when test="srch10 == '01'">
			          ORDER BY lastLisDay DESC, firstLisDay DESC, saleNo ASC, itemCode ASC
			        </when>
			        <otherwise>
		              ORDER BY firstLisDay DESC, lastLisDay DESC, saleNo ASC, itemCode ASC
			        </otherwise>
			    </choose>
				LIMIT #{recordCountPerPage} OFFSET #{startPage};
	</select>
	
	<select id="selectDuplicationItemViewExportList" parameterType="searchVO" resultType="egovMap">
	SELECT 
	COUNT(*) OVER() as CNT,
	itemCode,
	saleNo,
	reporter,
	desCirp,
	firstLisDay,
	lastLisDay
	FROM(
		SELECT 
		 item_code AS itemCode,
		 EXC_GNAME AS saleNo, 
		 REPORTER AS reporter,
		 ITEM_DESC AS desCirp, 
		 DATE_FORMAT((first_lis_day), '%Y-%m-%d') AS firstLisDay,
		 DATE_FORMAT((last_lis_day), '%Y-%m-%d') AS lastLisDay
		FROM 
		ITEM_INFO 
		WHERE 1=1
	<!-- WHERE cmpny_cd = #{corpNo} -->
	<if test="list != null and list.size() > 0">
           AND cmpny_cd IN 
           <foreach item="id" collection="list" open="(" separator="," close=")">
               #{id}
           </foreach>
      	</if>
				AND trade_type = 'exp'
				<choose>
			        <when test="srch10 == '01'">
			            AND last_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </when>
			        <otherwise>
			            AND first_lis_day BETWEEN REPLACE(#{srch2}, '-', '') AND REPLACE(#{srch3}, '-', '')
			        </otherwise>
		    	</choose>
				 ) A WHERE 1=1
				<if test="srchType1 != null and srchType1 != '' and srchText1 != null and srchText1 != ''">
				AND ${srchType1} LIKE CONCAT('%',UPPER(#{srchText1}),'%')
				</if>
				<if test="srchType2 != null and srchType2 != '' and srchText2 != null and srchText2 != ''">
				AND ${srchType2} LIKE CONCAT('%',UPPER(#{srchText2}),'%')
				</if>
				<choose>
			        <when test="srch10 == '01'">
			          ORDER BY lastLisDay DESC, firstLisDay DESC, saleNo ASC, itemCode ASC
			        </when>
			        <otherwise>
		              ORDER BY firstLisDay DESC, lastLisDay DESC, saleNo ASC, itemCode ASC
			        </otherwise>
			    </choose>
				LIMIT #{recordCountPerPage} OFFS
				LIMIT #{recordCountPerPage} OFFSET #{startPage};
	</select>
	
	<select id="selectItemViewLanList" parameterType="searchVO" resultType="egovMap">
	WITH CTE AS (
		    SELECT 
		        *,
		        ROW_NUMBER() OVER (ORDER BY lisDay DESC) AS rn
		    FROM (
		        SELECT 
		            CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END AS itemcode, 
		            SUBSTRING_INDEX(a.user_memo, '\n', 1) AS plntCd,
				    CASE WHEN STR_CNT(a.user_memo, '\n') >= 1 THEN
					SUBSTRING_INDEX(SUBSTRING_INDEX(a.user_memo, '\n', 2), '\n', -1)
					ELSE '' END AS prOrdr,
		            a.BlNo AS blNo, 
		            '' AS saleOrder, 
		            '' AS invoice, 
		            CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', 
		                   SUBSTRING(a.rpt_no, 6, 2), '-', 
		                   SUBSTRING(a.rpt_no, 8, 7)) AS rptNo,
		            a.nab_firm AS cmpnyNm,
		            b.ran_no AS ran, 
		            c.sil AS sil, 
		            DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') AS rptDay, 
		           	<!-- CONCAT(
					    CASE WHEN a.SDateTime != '' THEN 
					        CONCAT(
					            SUBSTRING(a.SDateTime, 1, 4), '-', 
					            SUBSTRING(a.SDateTime, 5, 2), '-', 
					            SUBSTRING(a.SDateTime, 7, 2), ' ' 
					        )
					    ELSE
					        ''
					    END
					) AS lisDay, -->
					CONCAT(
					    CASE WHEN a.Lis_Day != '' THEN 
					        CONCAT(
					            SUBSTRING(a.Lis_Day, 1, 4), '-', 
					            SUBSTRING(a.Lis_Day, 5, 2), '-', 
					            SUBSTRING(a.Lis_Day, 7, 2), ' ' 
					        )
					    ELSE
					        ''
					    END
					) AS lisDay,
		            CONCAT(SUBSTRING(b.HS, 1, 4), '.', 
		                   SUBSTRING(b.HS, 5, 2), '-', 
		                   SUBSTRING(b.HS, 7, 4)) AS hsCode,
		            b.Gs_Divi AS taxKi, 
		            b.Gs_Rate AS gsRate, 
		            c.Qty AS qty, 
		            c.Ut AS ut, 
		            c.Upi AS upi, 
		            b.Ori_St_Mark2 AS originMark
		        FROM
		        CUSDEC929A1 a
		        INNER JOIN CUSDEC929B1 b 
		        ON a.sn = b.sna1 
		        AND a.rpt_no = b.rpt_no AND a.BRANCH = b.BRANCH AND a.CUS_PRG = b.CUS_PRG
		        INNER JOIN CUSDEC929C1 c 
		        ON a.sn = c.sna1 AND b.sn = c.snb1 and a.rpt_no = b.rpt_no AND a.BRANCH = c.BRANCH AND a.CUS_PRG = c.CUS_PRG
		        WHERE 1=1
		            <if test="list != null and list.size() > 0">
			            AND a.nab_sdno IN 
			            <foreach item="id" collection="list" open="(" separator="," close=")">
			                #{id}
			            </foreach>
					</if>
		            AND a.Rpt_Seq = '00' 
		            AND (CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END) = #{srch2}
		         
		        
		        UNION 
		
		        SELECT 
		            CASE WHEN c.Mg_Cd = '' THEN c.Gnm1 ELSE c.Mg_Cd END AS itemcode, 
		           	SUBSTRING_INDEX(a.user_memo, '\n', 1) AS plntCd,
				    CASE WHEN STR_CNT(a.user_memo, '\n') >= 1 THEN
					SUBSTRING_INDEX(SUBSTRING_INDEX(a.user_memo, '\n', 2), '\n', -1)
					ELSE '' END AS prOrdr,
		            a.BlNo AS blNo, 
		            '' AS saleOrder, 
		            b.Mg_Code AS invoice, 
		            CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', 
		                   SUBSTRING(a.rpt_no, 6, 2), '-', 
		                   SUBSTRING(a.rpt_no, 8, 7)) AS rptNo,
		            a.exp_firm AS cmpnyNm,
		            b.ran_no AS ran, 
		            c.sil AS sil, 
		            DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') AS rptDay, 
						CONCAT(
					    CASE WHEN a.SDateTime != '' THEN 
					        CONCAT(
					            SUBSTRING(a.SDateTime, 1, 4), '-', 
					            SUBSTRING(a.SDateTime, 5, 2), '-', 
					            SUBSTRING(a.SDateTime, 7, 2), ' '
					        )
					    ELSE
					        ''
					    END
					) AS lisDay,
		            CONCAT(SUBSTRING(b.HS, 1, 4), '.', 
		                   SUBSTRING(b.HS, 5, 2), '-', 
		                   SUBSTRING(b.HS, 7, 4)) AS hsCode,
		            NULL AS taxKi, 
		            NULL AS gsRate, 
		            c.Qty AS qty, 
		            b.Ut AS ut, 
		            c.Price AS upi, 
		            b.Ori_St_Mark2 AS originMark
		        FROM 
		            CUSDEC830A1 a
		        INNER JOIN CUSDEC830B1 b ON a.SN = b.SNA1
		             AND a.rpt_no = b.rpt_no 
		             AND a.BRANCH = b.BRANCH 
		             AND a.CUS_PRG = b.CUS_PRG
		        INNER JOIN CUSDEC830C1 c ON a.SN = c.SNA1 AND c.SNB1 = b.SN
		            AND a.rpt_no = b.rpt_no 
		            AND a.BRANCH = c.BRANCH 
		            AND a.CUS_PRG = c.CUS_PRG
		       WHERE 1=1
		            <if test="list != null and list.size() > 0">
			            AND a.exp_sdno IN 
			            <foreach item="id" collection="list" open="(" separator="," close=")">
			                #{id}
			            </foreach>
					</if>
		            AND a.Rpt_Seq = '00'
		            AND (CASE WHEN c.Mg_Cd = '' THEN c.Gnm1 ELSE c.Mg_Cd END)= #{srch2}
		        
		    ) AS sub
		)
		SELECT 
		    COUNT(*) OVER() as CNT,
		    itemcode,
		    plntCd,
		    prOrdr,
		    blNo,
		    saleOrder,
		    invoice,
		    rptNo,
		    cmpnyNm,
		    ran,
		    sil,
		    rptDay,
		    lisDay,
		    hsCode,
		    taxKi,
		    gsRate,
		    qty,
		    ut,
		    upi,
		    originMark,
		    CASE 
			WHEN COALESCE(LAG(hscode) OVER (ORDER BY rn),'first') = 'first' OR COALESCE(LEAD(hscode) OVER (ORDER BY rn),'last') = 'last' THEN 'All Equal'
			WHEN hscode = LAG(hscode) OVER (ORDER BY rn) AND hscode = LEAD(hscode) OVER (ORDER BY rn) THEN 'All Equal'
			ELSE 'Not Equal'
			END AS result
		FROM 
		    CTE c
		ORDER BY lisDay DESC;
	</select>
	
	<select id="selectItemViewLanList2" parameterType="searchVO" resultType="egovMap">
	WITH CTE AS (
		    SELECT 
		        *,
		        ROW_NUMBER() OVER (ORDER BY lisDay DESC) AS rn
		    FROM (
		        SELECT 
		            CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END AS itemcode, 
		            SUBSTRING_INDEX(a.user_memo, '\n', 1) AS plntCd,
				    CASE WHEN STR_CNT(a.user_memo, '\n') >= 1 THEN
					SUBSTRING_INDEX(SUBSTRING_INDEX(a.user_memo, '\n', 2), '\n', -1)
					ELSE '' END AS prOrdr, 
		            a.BlNo AS blNo, 
		            '' AS saleOrder, 
		            '' AS invoice, 
		            CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', 
		                   SUBSTRING(a.rpt_no, 6, 2), '-', 
		                   SUBSTRING(a.rpt_no, 8, 7)) AS rptNo,
		            a.nab_firm as cmpnyNm,
		            b.ran_no AS ran, 
		            c.sil AS sil, 
		            DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') AS rptDay, 
		           	CONCAT(
					    CASE WHEN a.SDateTime != '' THEN 
					        CONCAT(
					            SUBSTRING(a.SDateTime, 1, 4), '-', 
					            SUBSTRING(a.SDateTime, 5, 2), '-', 
					            SUBSTRING(a.SDateTime, 7, 2), ' '<!-- , 
					            SUBSTRING(a.SDateTime, 9, 2), ':', 
					            SUBSTRING(a.SDateTime, 11, 2) -->
					        )
					    ELSE
					        ''
					    END
					) AS lisDay,
		            CONCAT(SUBSTRING(b.HS, 1, 4), '.', 
		                   SUBSTRING(b.HS, 5, 2), '-', 
		                   SUBSTRING(b.HS, 7, 4)) AS hsCode,
		            b.Gs_Divi AS taxKi, 
		            b.Gs_Rate AS gsRate, 
		            c.Qty AS qty, 
		            c.Ut AS ut, 
		            c.Upi AS upi, 
		            b.Ori_St_Mark2 AS originMark
		        FROM
		        CUSDEC929A1 a
		        INNER JOIN CUSDEC929B1 b 
		        ON a.sn = b.sna1 
		        AND a.rpt_no = b.rpt_no AND a.BRANCH = b.BRANCH AND a.CUS_PRG = b.CUS_PRG
		        INNER JOIN CUSDEC929C1 c 
		        ON a.sn = c.sna1 AND b.sn = c.snb1 and a.rpt_no = b.rpt_no AND a.BRANCH = c.BRANCH AND a.CUS_PRG = c.CUS_PRG
		       WHERE 1=1
		            <if test="list != null and list.size() > 0">
			            AND a.nab_sdno IN 
			            <foreach item="id" collection="list" open="(" separator="," close=")">
			                #{id}
			            </foreach>
					</if>
		            AND a.Rpt_Seq = '00' 
		            AND (CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END) = #{srch2}
		        UNION 
		
		        SELECT 
		            CASE WHEN c.Mg_Cd = '' THEN c.Gnm1 ELSE c.Mg_Cd END AS itemcode, 
		            SUBSTRING_INDEX(a.user_memo, '\n', 1) AS plntCd,
				    CASE WHEN STR_CNT(a.user_memo, '\n') >= 1 THEN
					SUBSTRING_INDEX(SUBSTRING_INDEX(a.user_memo, '\n', 2), '\n', -1)
					ELSE '' END AS prOrdr, 
		            a.BlNo AS blNo, 
		            '' AS saleOrder, 
		            b.Mg_Code AS invoice, 
		            CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', 
		                   SUBSTRING(a.rpt_no, 6, 2), '-', 
		                   SUBSTRING(a.rpt_no, 8, 7)) AS rptNo,
		            a.exp_firm as cmpnyNm,
		            b.ran_no AS ran, 
		            c.sil AS sil, 
		            DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') AS rptDay, 
						CONCAT(
					    CASE WHEN a.SDateTime != '' THEN 
					        CONCAT(
					            SUBSTRING(a.SDateTime, 1, 4), '-', 
					            SUBSTRING(a.SDateTime, 5, 2), '-', 
					            SUBSTRING(a.SDateTime, 7, 2), ' '
					        )
					    ELSE
					        ''
					    END
					) AS lisDay,
		            CONCAT(SUBSTRING(b.HS, 1, 4), '.', 
		                   SUBSTRING(b.HS, 5, 2), '-', 
		                   SUBSTRING(b.HS, 7, 4)) AS hsCode,
		            NULL AS taxKi, 
		            NULL AS gsRate, 
		            c.Qty AS qty, 
		            b.Ut AS ut, 
		            c.Price AS upi, 
		            b.Ori_St_Mark2 AS originMark
		        FROM 
		            CUSDEC830A1 a
		        INNER JOIN CUSDEC830B1 b ON a.SN = b.SNA1
		             AND a.rpt_no = b.rpt_no 
		             AND a.BRANCH = b.BRANCH 
		             AND a.CUS_PRG = b.CUS_PRG
		        INNER JOIN CUSDEC830C1 c ON a.SN = c.SNA1 AND c.SNB1 = b.SN
		            AND a.rpt_no = b.rpt_no 
		            AND a.BRANCH = c.BRANCH 
		            AND a.CUS_PRG = c.CUS_PRG
		        WHERE 1=1
		            <if test="list != null and list.size() > 0">
			            AND a.exp_sdno IN 
			            <foreach item="id" collection="list" open="(" separator="," close=")">
			                #{id}
			            </foreach>
					</if>
		            AND a.Rpt_Seq = '00'
		            AND (CASE WHEN c.Mg_Cd = '' THEN c.Gnm1 ELSE c.Mg_Cd END)= #{srch2}
		    ) AS sub
		)
		SELECT 
		    COUNT(*) OVER() as CNT,
		    itemcode,
		    plntCd,
		    prOrdr,
		    blNo,
		    saleOrder,
		    invoice,
		    rptNo,
		    cmpnyNm,
		    ran,
		    sil,
		    rptDay,
		    lisDay,
		    hsCode,
		    taxKi,
		    gsRate,
		    qty,
		    ut,
		    upi,
		    originMark,
		    CASE 
			WHEN COALESCE(LAG(hscode) OVER (ORDER BY rn),'first') = 'first' OR COALESCE(LEAD(hscode) OVER (ORDER BY rn),'last') = 'last' THEN 'All Equal'
			WHEN hscode = LAG(hscode) OVER (ORDER BY rn) AND hscode = LEAD(hscode) OVER (ORDER BY rn) THEN 'All Equal'
			ELSE 'Not Equal'
			END AS result
		FROM 
		    CTE c
		 WHERE 1=1
	    <if test="srchType3 != null and srchType3 != '' and srchText3 != null and srchText3 != ''">
		AND ${srchType3} LIKE CONCAT('%',UPPER(#{srchText3}),'%')
		</if>
		<if test="srchType4 != null and srchType4 != '' and srchText4 != null and srchText4 != ''">
		AND ${srchType4} LIKE CONCAT('%',UPPER(#{srchText4}),'%')
		</if>
		ORDER BY lisDay DESC;
	</select>
	
	<!-- 수입통관정보 -->
	<select id="selectItemViewLanImportList" parameterType="searchVO" resultType="egovMap">
		WITH CTE AS (
			    SELECT 
			        *,
			        ROW_NUMBER() OVER (ORDER BY lisDay DESC) AS rn
			    FROM (
			        SELECT 
			            CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END AS itemcode, 
			            SUBSTRING_INDEX(a.user_memo, '\n', 1) AS plntCd,
					    CASE WHEN STR_CNT(a.user_memo, '\n') >= 1 THEN
						SUBSTRING_INDEX(SUBSTRING_INDEX(a.user_memo, '\n', 2), '\n', -1)
						ELSE '' END AS prOrdr, 
			            a.BlNo AS blNo, 
			            '' AS saleOrder, 
			            '' AS invoice, 
			            CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', 
			                   SUBSTRING(a.rpt_no, 6, 2), '-', 
			                   SUBSTRING(a.rpt_no, 8, 7)) AS rptNo,
			            a.nab_firm as cmpnyNm,
			            b.ran_no AS ran, 
			            c.sil AS sil, 
			            DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') AS rptDay, 
			           	CONCAT(
						    CASE WHEN a.SDateTime != '' THEN 
						        CONCAT(
						            SUBSTRING(a.SDateTime, 1, 4), '-', 
						            SUBSTRING(a.SDateTime, 5, 2), '-', 
						            SUBSTRING(a.SDateTime, 7, 2), ' '
						        )
						    ELSE
						        ''
						    END
						) AS lisDay,
			            CONCAT(SUBSTRING(b.HS, 1, 4), '.', 
			                   SUBSTRING(b.HS, 5, 2), '-', 
			                   SUBSTRING(b.HS, 7, 4)) AS hsCode,
			            b.Gs_Divi AS taxKi, 
			            b.Gs_Rate AS gsRate, 
			            c.Qty AS qty, 
			            c.Ut AS ut, 
			            c.Upi AS upi, 
			            b.Ori_St_Mark2 AS originMark
			        FROM
			        CUSDEC929A1 a
			        INNER JOIN CUSDEC929B1 b 
			        ON a.sn = b.sna1 
			        AND a.rpt_no = b.rpt_no AND a.BRANCH = b.BRANCH AND a.CUS_PRG = b.CUS_PRG
			        INNER JOIN CUSDEC929C1 c 
			        ON a.sn = c.sna1 AND b.sn = c.snb1 and a.rpt_no = b.rpt_no AND a.BRANCH = c.BRANCH AND a.CUS_PRG = c.CUS_PRG
			        WHERE 1=1
		            	<if test="list != null and list.size() > 0">
				            AND a.nab_sdno IN 
				            <foreach item="id" collection="list" open="(" separator="," close=")">
				                #{id}
				            </foreach>
						</if>
			            AND a.Rpt_Seq = '00' 
			            AND (CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END) = #{srch2}
			         
			    ) AS sub
			)
			SELECT 
			    COUNT(*) OVER() as CNT,
			    itemcode,
			    plntCd,
			    prOrdr,
			    blNo,
			    saleOrder,
			    invoice,
			    rptNo,
			    cmpnyNm,
			    ran,
			    sil,
			    rptDay,
			    lisDay,
			    hsCode,
			    taxKi,
			    gsRate,
			    qty,
			    ut,
			    upi,
			    originMark,
			    CASE 
				WHEN COALESCE(LAG(hscode) OVER (ORDER BY rn),'first') = 'first' OR COALESCE(LEAD(hscode) OVER (ORDER BY rn),'last') = 'last' THEN 'All Equal'
				WHEN hscode = LAG(hscode) OVER (ORDER BY rn) AND hscode = LEAD(hscode) OVER (ORDER BY rn) THEN 'All Equal'
				ELSE 'Not Equal'
				END AS result
			FROM 
			    CTE c
			ORDER BY lisDay DESC;
	</select>
	<!-- 수출통관 정보 -->
	<select id="selectItemViewLanExportList" parameterType="searchVO" resultType="egovMap">
		WITH CTE AS (
		    SELECT 
		        *,
		        ROW_NUMBER() OVER (ORDER BY lisDay DESC) AS rn
		    FROM (
		        SELECT 
		            CASE WHEN c.Mg_Cd = '' THEN c.Gnm1 ELSE c.Mg_Cd END AS itemcode, 
		            SUBSTRING_INDEX(a.user_memo, '\n', 1) AS plntCd,
				    CASE WHEN STR_CNT(a.user_memo, '\n') >= 1 THEN
					SUBSTRING_INDEX(SUBSTRING_INDEX(a.user_memo, '\n', 2), '\n', -1)
					ELSE '' END AS prOrdr, 
		            a.BlNo AS blNo, 
		            '' AS saleOrder, 
		            b.Mg_Code AS invoice, 
		            CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', 
		                   SUBSTRING(a.rpt_no, 6, 2), '-', 
		                   SUBSTRING(a.rpt_no, 8, 7)) AS rptNo,
		            a.exp_firm as cmpnyNm,
		            b.ran_no AS ran, 
		            c.sil AS sil, 
		            DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') AS rptDay, 
						CONCAT(
					    CASE WHEN a.SDateTime != '' THEN 
					        CONCAT(
					            SUBSTRING(a.SDateTime, 1, 4), '-', 
					            SUBSTRING(a.SDateTime, 5, 2), '-', 
					            SUBSTRING(a.SDateTime, 7, 2), ' '
					        )
					    ELSE
					        ''
					    END
					) AS lisDay,
		            CONCAT(SUBSTRING(b.HS, 1, 4), '.', 
		                   SUBSTRING(b.HS, 5, 2), '-', 
		                   SUBSTRING(b.HS, 7, 4)) AS hsCode,
		            NULL AS taxKi, 
		            NULL AS gsRate, 
		            c.Qty AS qty, 
		            b.Ut AS ut, 
		            c.Price AS upi, 
		            b.Ori_St_Mark2 AS originMark
		        FROM 
		            CUSDEC830A1 a
		        INNER JOIN CUSDEC830B1 b ON a.SN = b.SNA1
		             AND a.rpt_no = b.rpt_no 
		             AND a.BRANCH = b.BRANCH 
		             AND a.CUS_PRG = b.CUS_PRG
		        INNER JOIN CUSDEC830C1 c ON a.SN = c.SNA1 AND c.SNB1 = b.SN
		            AND a.rpt_no = b.rpt_no 
		            AND a.BRANCH = c.BRANCH 
		            AND a.CUS_PRG = c.CUS_PRG
		        WHERE 1=1
		            	<if test="list != null and list.size() > 0">
				            AND a.exp_sdno IN 
				            <foreach item="id" collection="list" open="(" separator="," close=")">
				                #{id}
				            </foreach>
						</if>
		            AND a.Rpt_Seq = '00'
		            AND (CASE WHEN c.Mg_Cd = '' THEN c.Gnm1 ELSE c.Mg_Cd END)= #{srch2}
		        
		    ) AS sub
		)
		SELECT 
		    COUNT(*) OVER() as CNT,
		    itemcode,
		    plntCd,
		    prOrdr,
		    blNo,
		    saleOrder,
		    invoice,
		    rptNo,
		    cmpnyNm,
		    ran,
		    sil,
		    rptDay,
		    lisDay,
		    hsCode,
		    taxKi,
		    gsRate,
		    qty,
		    ut,
		    upi,
		    originMark,
		    CASE 
			WHEN COALESCE(LAG(hscode) OVER (ORDER BY rn),'first') = 'first' OR COALESCE(LEAD(hscode) OVER (ORDER BY rn),'last') = 'last' THEN 'All Equal'
			WHEN hscode = LAG(hscode) OVER (ORDER BY rn) AND hscode = LEAD(hscode) OVER (ORDER BY rn) THEN 'All Equal'
			ELSE 'Not Equal'
			END AS result
		FROM 
		    CTE c
		ORDER BY lisDay DESC;
	</select>
	
	<!-- 수입통관 정보 검색 -->
	<select id="selectitemViewLanImportList2" parameterType="searchVO" resultType="egovMap">
		WITH CTE AS (
		    SELECT 
		        *,
		        ROW_NUMBER() OVER (ORDER BY lisDay DESC) AS rn
		    FROM (
		        SELECT 
		            CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END AS itemcode, 
		            SUBSTRING_INDEX(a.user_memo, '\n', 1) AS plntCd,
				    CASE WHEN STR_CNT(a.user_memo, '\n') >= 1 THEN
					SUBSTRING_INDEX(SUBSTRING_INDEX(a.user_memo, '\n', 2), '\n', -1)
					ELSE '' END AS prOrdr, 
		            a.BlNo AS blNo, 
		            '' AS saleOrder, 
		            '' AS invoice, 
		            CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', 
		                   SUBSTRING(a.rpt_no, 6, 2), '-', 
		                   SUBSTRING(a.rpt_no, 8, 7)) AS rptNo,
		            a.nab_firm as cmpnyNm,
		            b.ran_no AS ran, 
		            c.sil AS sil, 
		            DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') AS rptDay, 
		           	CONCAT(
					    CASE WHEN a.SDateTime != '' THEN 
					        CONCAT(
					            SUBSTRING(a.SDateTime, 1, 4), '-', 
					            SUBSTRING(a.SDateTime, 5, 2), '-', 
					            SUBSTRING(a.SDateTime, 7, 2), ' '<!-- , 
					            SUBSTRING(a.SDateTime, 9, 2), ':', 
					            SUBSTRING(a.SDateTime, 11, 2) -->
					        )
					    ELSE
					        ''
					    END
					) AS lisDay,
		            CONCAT(SUBSTRING(b.HS, 1, 4), '.', 
		                   SUBSTRING(b.HS, 5, 2), '-', 
		                   SUBSTRING(b.HS, 7, 4)) AS hsCode,
		            b.Gs_Divi AS taxKi, 
		            b.Gs_Rate AS gsRate, 
		            c.Qty AS qty, 
		            c.Ut AS ut, 
		            c.Upi AS upi, 
		            b.Ori_St_Mark2 AS originMark
		        FROM
		        CUSDEC929A1 a
		        INNER JOIN CUSDEC929B1 b 
		        ON a.sn = b.sna1 
		        AND a.rpt_no = b.rpt_no AND a.BRANCH = b.BRANCH AND a.CUS_PRG = b.CUS_PRG
		        INNER JOIN CUSDEC929C1 c 
		        ON a.sn = c.sna1 AND b.sn = c.snb1 and a.rpt_no = b.rpt_no AND a.BRANCH = c.BRANCH AND a.CUS_PRG = c.CUS_PRG
		       WHERE 1=1
		            	<if test="list != null and list.size() > 0">
				            AND a.nab_sdno IN 
				            <foreach item="id" collection="list" open="(" separator="," close=")">
				                #{id}
				            </foreach>
						</if>
		            AND a.Rpt_Seq = '00' 
		            AND (CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END) = #{srch2}
		    ) AS sub
		)
		SELECT 
		    COUNT(*) OVER() as CNT,
		    itemcode,
		    plntCd,
		    prOrdr,
		    blNo,
		    saleOrder,
		    invoice,
		    rptNo,
		    cmpnyNm,
		    ran,
		    sil,
		    rptDay,
		    lisDay,
		    hsCode,
		    taxKi,
		    gsRate,
		    qty,
		    ut,
		    upi,
		    originMark,
		    CASE 
		    WHEN c.rn = 1 OR c.rn = (SELECT COUNT(*) FROM CTE) THEN 'All Equal'
		    WHEN hsCode = (SELECT hsCode FROM CTE WHERE rn = c.rn - 1) AND hsCode = (SELECT hsCode FROM CTE WHERE rn = c.rn + 1) THEN 'All Equal' 
		    WHEN hsCode = (SELECT hsCode FROM CTE WHERE rn = c.rn - 1) THEN 'Not Equal' 
		    WHEN hsCode = (SELECT hsCode FROM CTE WHERE rn = c.rn + 1) THEN 'Not Equal' 
		    ELSE 'Not Equal' 
		    END AS result
		FROM 
		    CTE c
		WHERE 1=1
		    <if test="srchType3 != null and srchType3 != '' and srchText3 != null and srchText3 != ''">
			AND ${srchType3} LIKE CONCAT('%',UPPER(#{srchText3}),'%')
			</if>
			<if test="srchType4 != null and srchType4 != '' and srchText4 != null and srchText4 != ''">
			AND ${srchType4} LIKE CONCAT('%',UPPER(#{srchText4}),'%')
			</if>
		ORDER BY lisDay DESC,RN ASC;
	</select>
	<!-- 수출통관 정보 검색 -->
	<select id ="selectitemViewLanExportList2" parameterType="searchVO" resultType="egovMap">
		WITH CTE AS (
		    SELECT 
		        *,
		        ROW_NUMBER() OVER (ORDER BY lisDay DESC) AS rn
		    FROM (
		        SELECT 
		            CASE WHEN c.Mg_Cd = '' THEN c.Gnm1 ELSE c.Mg_Cd END AS itemcode, 
		            SUBSTRING_INDEX(a.user_memo, '\n', 1) AS plntCd,
				    CASE WHEN STR_CNT(a.user_memo, '\n') >= 1 THEN
					SUBSTRING_INDEX(SUBSTRING_INDEX(a.user_memo, '\n', 2), '\n', -1)
					ELSE '' END AS prOrdr, 
		            a.BlNo AS blNo, 
		            '' AS saleOrder, 
		            b.Mg_Code AS invoice, 
		            CONCAT(SUBSTRING(a.rpt_no, 1, 5), '-', 
		                   SUBSTRING(a.rpt_no, 6, 2), '-', 
		                   SUBSTRING(a.rpt_no, 8, 7)) AS rptNo,
		            a.exp_firm as cmpnyNm,
		            b.ran_no AS ran, 
		            c.sil AS sil, 
		            DATE_FORMAT(a.Rpt_Day, '%Y-%m-%d') AS rptDay, 
						CONCAT(
					    CASE WHEN a.SDateTime != '' THEN 
					        CONCAT(
					            SUBSTRING(a.SDateTime, 1, 4), '-', 
					            SUBSTRING(a.SDateTime, 5, 2), '-', 
					            SUBSTRING(a.SDateTime, 7, 2), ' '<!-- , 
					            SUBSTRING(a.SDateTime, 9, 2), ':', 
					            SUBSTRING(a.SDateTime, 11, 2) -->
					        )
					    ELSE
					        ''
					    END
					) AS lisDay,
		            CONCAT(SUBSTRING(b.HS, 1, 4), '.', 
		                   SUBSTRING(b.HS, 5, 2), '-', 
		                   SUBSTRING(b.HS, 7, 4)) AS hsCode,
		            NULL AS taxKi, 
		            NULL AS gsRate, 
		            c.Qty AS qty, 
		            b.Ut AS ut, 
		            c.Price AS upi, 
		            b.Ori_St_Mark2 AS originMark
		        FROM 
		            CUSDEC830A1 a
		        INNER JOIN CUSDEC830B1 b ON a.SN = b.SNA1
		             AND a.rpt_no = b.rpt_no 
		             AND a.BRANCH = b.BRANCH 
		             AND a.CUS_PRG = b.CUS_PRG
		        INNER JOIN CUSDEC830C1 c ON a.SN = c.SNA1 AND c.SNB1 = b.SN
		            AND a.rpt_no = b.rpt_no 
		            AND a.BRANCH = c.BRANCH 
		            AND a.CUS_PRG = c.CUS_PRG
		       WHERE 1=1
		            	<if test="list != null and list.size() > 0">
				            AND a.exp_sdno IN 
				            <foreach item="id" collection="list" open="(" separator="," close=")">
				                #{id}
				            </foreach>
						</if>
		            AND a.Rpt_Seq = '00'
		            AND (CASE WHEN c.Mg_Cd = '' THEN c.Gnm1 ELSE c.Mg_Cd END)= #{srch2}
		    ) AS sub
		)
		SELECT 
		    COUNT(*) OVER() as CNT,
		    itemcode,
		    plntCd,
		    prOrdr,
		    blNo,
		    saleOrder,
		    invoice,
		    rptNo,
		    cmpnyNm,
		    ran,
		    sil,
		    rptDay,
		    lisDay,
		    hsCode,
		    taxKi,
		    gsRate,
		    qty,
		    ut,
		    upi,
		    originMark,
		    CASE 
		    WHEN c.rn = 1 OR c.rn = (SELECT COUNT(*) FROM CTE) THEN 'All Equal'
		    WHEN hsCode = (SELECT hsCode FROM CTE WHERE rn = c.rn - 1) AND hsCode = (SELECT hsCode FROM CTE WHERE rn = c.rn + 1) THEN 'All Equal' 
		    WHEN hsCode = (SELECT hsCode FROM CTE WHERE rn = c.rn - 1) THEN 'Not Equal' 
		    WHEN hsCode = (SELECT hsCode FROM CTE WHERE rn = c.rn + 1) THEN 'Not Equal' 
		    ELSE 'Not Equal' 
		    END AS result
		FROM 
		    CTE c
		WHERE 1=1
		  <if test="srchType3 != null and srchType3 != '' and srchText3 != null and srchText3 != ''">
			AND ${srchType3} LIKE CONCAT('%',UPPER(#{srchText3}),'%')
			</if>
			<if test="srchType4 != null and srchType4 != '' and srchText4 != null and srchText4 != ''">
			AND ${srchType4} LIKE CONCAT('%',UPPER(#{srchText4}),'%')
			</if>
		ORDER BY lisDay DESC,RN ASC;
	</select>
	<!-- 레디 요건 정보  -->
	<select id="selectItemViewSpecListView" parameterType="searchVO" resultType="egovMap">
		SELECT  
		    CASE 
		        WHEN c.RG_code = '' THEN c.IMP_GName1 
		        ELSE c.RG_code 
		    END AS 'itemCode', 
		    c.ran_no AS ran, 
		    c.sil AS sil, 
		    a.rpt_no AS rptNo,
		    d.CONT AS criteria, 
		    d.VIT_NO AS certNum,
		    e.Exclude_NM AS nonEli
		FROM 
		    cusdec929a1 a
		    INNER JOIN CUSDEC929C1 c 
		        ON a.SN = c.SNA1 
		        AND a.rpt_no = c.rpt_no 
		        AND a.BRANCH = c.BRANCH 
		        AND a.CUS_PRG = c.CUS_PRG
		    INNER JOIN (
		        SELECT 
		            sna1, 
		            rpt_no,
		            branch, 
		            cus_prg, 
		            law_cd,
		            GROUP_CONCAT(DISTINCT b.cont SEPARATOR ',') AS cont,
		            GROUP_CONCAT(DISTINCT VIT_NO SEPARATOR ',') AS VIT_NO 
		        FROM 
		            cusdec929d1 a
		            LEFT OUTER JOIN (
		                SELECT DISTINCT CODE, cont
		                FROM cdstd
		                WHERE divi = '법령코드'
		            ) b ON a.LAW_CD = b.code
		        GROUP BY 
		            a.sna1, 
		            a.rpt_no, 
		            a.branch, 
		            a.cus_prg
		    ) d ON a.SN = d.SNA1 
		        AND a.rpt_no = d.rpt_no 
		        AND a.BRANCH = d.BRANCH 
		        AND a.CUS_PRG = d.CUS_PRG
		    LEFT JOIN CUSDEC929C4 e 
		        ON c.SNA1 = e.SNA1 
		        AND c.rpt_no = e.rpt_no 
		        AND c.BRANCH = e.BRANCH 
		        AND c.CUS_PRG = e.CUS_PRG  
		        AND c.ran_NO = e.ran_no 
		        AND CAST(c.sil AS INTEGER) = CAST(e.sil AS INTEGER)
		WHERE 
		    1=1 
		    AND (CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END) = #{srch2}
           	<if test="list != null and list.size() > 0">
	            AND a.nab_sdno IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
			</if>
		    AND a.Rpt_Seq = '00'
		    AND a.rpt_no = REPLACE(#{srch3}, '-', '')
		    AND c.ran_NO = #{srch4}
		    AND c.sil = #{srch5}
	</select>
	
	<!-- 엑셀 레디 요건 정보  -->
	<select id="selectItemViewSpecExcelList" parameterType="searchVO" resultType="egovMap">
		SELECT  
			CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END AS 'itemCode', 
			c.ran_no AS ran, 
			C.sil AS sil, 
			a.rpt_no AS rptNo,
			d.CONT AS criteria, 
			d.VIT_NO AS certNum,
			e.Exclude_NM AS nonEli
			FROM cusdec929a1 a
			INNER JOIN CUSDEC929C1 c 
			ON a.SN = c.SNA1 
			AND a.rpt_no = C.rpt_no 
			AND a.BRANCH = C.BRANCH 
			AND A.CUS_PRG = C.CUS_PRG
			INNER JOIN 
			(
			SELECT sna1, rpt_no ,branch, cus_prg, law_cd
			,GROUP_CONCAT(distinct b.cont SEPARATOR ',') as cont
			,GROUP_CONCAT(distinct VIT_NO SEPARATOR ',') as VIT_NO 
			FROM cusdec929d1 a
			LEFT OUTER JOIN (SELECT DISTINCT CODE, cont
			FROM cdstd
			WHERE divi = '법령코드') b
			ON a.LAW_CD = b.code
			GROUP BY a.sna1
			) d 
			ON a.SN = d.SNA1 
			AND a.rpt_no = D.rpt_no 
			AND a.BRANCH = D.BRANCH 
			AND A.CUS_PRG = D.CUS_PRG
			left JOIN CUSDEC929C4 e 
			on c.SNA1 = E.SNA1 
			AND c.rpt_no = E.rpt_no 
			AND c.BRANCH = E.BRANCH 
			AND c.CUS_PRG = E.CUS_PRG  
			AND c.ran_NO = e.Ran_no 
			AND CAST(c.sil AS INTEGER) = CAST(e.sil AS INTEGER)
			WHERE 1=1 
			AND (CASE WHEN c.RG_code = '' THEN c.IMP_GName1 ELSE c.RG_code END) = #{srch2}
			<if test="list != null and list.size() > 0">
	            AND a.nab_sdno IN 
	            <foreach item="id" collection="list" open="(" separator="," close=")">
	                #{id}
	            </foreach>
			</if>
			AND a.Rpt_Seq = '00'
	</select>
	
	<!-- iOOM 요건 정보  -->
	<select id="selectItemViewSpecList" parameterType="searchVO" resultType="egovMap">
		SELECT 
			ITEM_SEQ AS itemSeq,
			ITEM_CD AS itemCode,
			RPT_NO AS rptNo,
			ITEM_RAN AS ran,
			ITEM_SIL AS sil,
			USR_NAME AS usrName,
		    CASE
		    WHEN EDT_DT IS NOT NULL THEN DATE_FORMAT(STR_TO_DATE(EDT_DT, '%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    ELSE DATE_FORMAT(STR_TO_DATE(REG_DT,'%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    END AS regDt,	
			CRITERIA AS criteria,
			CRETNUM AS certNum,
			NONELI AS nonEli
		FROM 
			ITEM_REQUIREMENT 
		WHERE 
			ITEM_CD = #{srch2}
			AND RPT_NO = REPLACE(#{srch3},'-','')
			AND ITEM_RAN = #{srch4}
			AND ITEM_SIL = #{srch5}
			AND DEL_YN = 'N'
	</select>

	<select id="selectItemViewMemoList" parameterType="searchVO" resultType="egovMap">
		SELECT 
		   CASE
		    WHEN EDT_DT IS NOT NULL THEN DATE_FORMAT(STR_TO_DATE(EDT_DT, '%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    ELSE DATE_FORMAT(STR_TO_DATE(REG_DT,'%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    END AS regDt,
		    MEMO_SEQ AS memoSeq,
		     ITEM_CD AS itemCd,
		    RPT_NO AS rptNo,
		    ITEM_RAN AS ran,
		    ITEM_SIL AS sil,				
			USR_NAME AS userName,
			ITEM_MEMO AS userMemo
		FROM 
			ITEM_MEMO
		WHERE 
			ITEM_CD = #{srch2}
			AND RPT_NO = REPLACE(#{srch3},'-','')
			AND ITEM_RAN = #{srch5}
			AND ITEM_SIL = #{srch6}
			AND DEL_YN = 'N'
	</select>
	<select id = "selectEditItemViewSpecList" parameterType = "searchVO" resultType="egovMap">
		SELECT 
			ITEM_SEQ AS itemSeq,
			ITEM_CD AS itemCode,
			RPT_NO AS rptNo,
			ITEM_RAN AS ran,
			ITEM_SIL AS sil,
			USR_NAME AS usrName,
		    CASE
		    WHEN EDT_DT IS NOT NULL THEN DATE_FORMAT(STR_TO_DATE(EDT_DT, '%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    ELSE DATE_FORMAT(STR_TO_DATE(REG_DT,'%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    END AS regDt,	
			CRITERIA AS criteria,
			CRETNUM AS certNum,
			NONELI AS nonEli
		FROM 
			ITEM_REQUIREMENT 
		WHERE 
			ITEM_CD = #{srch2}
			AND RPT_NO = REPLACE(#{srch3},'-','')
			AND ITEM_RAN = #{srch4}
			AND ITEM_SIL = #{srch5}
			AND USR_NAME = #{srch1}
			AND DEL_YN = 'N'
	</select>
	
	<select id="selecteditItemViewMemoList" parameterType="searchVO" resultType="egovMap">
		SELECT 
		   CASE
		    WHEN EDT_DT IS NOT NULL THEN DATE_FORMAT(STR_TO_DATE(EDT_DT, '%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    ELSE DATE_FORMAT(STR_TO_DATE(REG_DT,'%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    END AS regDt,
		    MEMO_SEQ AS memoSeq,
		     ITEM_CD AS itemCd,
		    RPT_NO AS rptNo,
		    ITEM_RAN AS ran,
		    ITEM_SIL AS sil,				
			USR_NAME AS userName,
			ITEM_MEMO AS userMemo
		FROM 
			ITEM_MEMO
		WHERE 
			USR_ID = #{srch1}
			AND ITEM_CD = #{srch2}
			AND RPT_NO = REPLACE(#{srch3},'-','')
			AND ITEM_RAN = #{srch5}
			AND ITEM_SIL = #{srch6}
			AND DEL_YN = 'N'
	</select>
	
	<select id="selecteditItemViewMemoExcelList" parameterType="searchVO" resultType="egovMap">
		SELECT 
		   CASE
		    WHEN EDT_DT IS NOT NULL THEN DATE_FORMAT(STR_TO_DATE(EDT_DT, '%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    ELSE DATE_FORMAT(STR_TO_DATE(REG_DT,'%Y%m%d%H%i'), '%Y-%m-%d %H:%i')
		    END AS regDt,
		    ITEM_CD AS itemCd,
		    RPT_NO AS rptNo,
		    ITEM_RAN AS ran,
		    ITEM_SIL AS sil,				
			USR_NAME AS userName,
			ITEM_MEMO AS userMemo
		FROM 
			ITEM_MEMO
		WHERE 
			ITEM_CD = #{srch2}
			AND DEL_YN = 'N'
	</select>
	
	<insert id="insertItemViewSpec" parameterType="egovframework.pf.item.service.SaveSpecVO">
		INSERT INTO ITEM_REQUIREMENT(
			ITEM_CD,      <!-- 아이템코드 -->
			RPT_NO,       <!-- 신고번호 -->
			CRITERIA,     <!-- 대상요건 -->
			CRETNUM,      <!-- 인증번호 -->
			NONELI,
			ITEM_RAN,
	        ITEM_SIL,
	        USR_NAME,        
			DEL_YN,
			REG_DT,
			REG_ID
	  )VALUES (
	  		#{itemCode},
	  		REPLACE(#{rptNo},'-',''),
	  		#{criteria},
	  		#{certNum},
	  		#{nonEli},
	  		#{ran},
	  		#{sil},
	  		#{usrName},
	  		'N',
	  		DATE_FORMAT(NOW(), '%Y%m%d%H%i'),
	  		#{regId}
	  )ON DUPLICATE KEY
	  	UPDATE EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d%H%i')
			 , EDT_ID = #{regId}
			 , CRITERIA = #{criteria}
			 , CRETNUM = #{certNum}
			 , NONELI = #{nonEli}
	  		<if test = "delYn != null and delYn != ''">
			  , DEL_YN = 'N'
			</if>
	</insert> 
	
	<insert id="insertItemViewMemo" parameterType="egovframework.pf.item.service.SaveMemoVO">
		INSERT INTO ITEM_MEMO(
			ITEM_CD,      <!-- 아이템코드 -->
			RPT_NO,       <!-- 신고번호 -->
			ITEM_RAN,	  <!--아이템 란  -->
	        ITEM_SIL,	  <!--아이템 규격  -->
	        USR_ID,
	        USR_NAME,  
	        ITEM_MEMO,    <!-- 메모내용 -->   
			DEL_YN,
			REG_DT,
			REG_ID
	  )VALUES (
	  		#{itemCd},
	  		REPLACE(#{rptNo},'-',''),
	  		#{ran},
	  		#{sil},
	  		#{regId},
	  		#{userName},
	  		#{userMemo},
	  		'N',
	  		DATE_FORMAT(NOW(), '%Y%m%d%H%i'),
	  		#{regId}
	  )ON DUPLICATE KEY
	  	UPDATE EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d%H%i')
			 , EDT_ID = #{regId}
			 , ITEM_MEMO = #{userMemo}
	  		<if test = "delYn != null and delYn != ''">
			  , DEL_YN = 'N'
			</if>
	</insert> 
	
	<update id="updateItemViewSpec" parameterType="egovframework.pf.item.service.SaveSpecVO">
	UPDATE 
			ITEM_REQUIREMENT
	SET           
			CRITERIA = #{criteria}   <!-- 대상요건 -->
			,CRETNUM =  #{certNum}    <!-- 인증번호 -->
			,NONELI  = #{nonEli}      <!-- 비대상사유 -->
			,DEL_YN = 'N'
			,EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d%H%i')
			,EDT_ID = #{usrName}
	WHERE 
		  ITEM_SEQ = #{itemSeq}
	AND	  ITEM_RAN = #{ran}
	AND   ITEM_SIL = #{sil}
	AND   USR_NAME = #{usrName}	  
 	AND   ITEM_CD = #{itemCode}
	AND   RPT_NO = REPLACE(#{rptNo},'-','')
	
	</update>
	
	
	<update id="updateItemViewMemo" parameterType="egovframework.pf.item.service.SaveMemoVO">
	UPDATE 
			ITEM_MEMO
	SET    
			ITEM_MEMO = #{userMemo}
			,DEL_YN = 'N'
			,EDT_DT = DATE_FORMAT(NOW(), '%Y%m%d%H%i')
			,EDT_ID = #{edtId}
	WHERE 
		  MEMO_SEQ = #{memoSeq}
 	AND   ITEM_CD = #{itemCd}
	AND   RPT_NO = REPLACE(#{rptNo},'-','')
	AND	  ITEM_RAN = #{ran}
	AND   ITEM_SIL = #{sil}
	</update>
	

</mapper>